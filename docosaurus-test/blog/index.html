<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Blog | Petr&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog-test.ruzicka.dev/docosaurus-test/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog-test.ruzicka.dev/docosaurus-test/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog-test.ruzicka.dev/docosaurus-test/blog"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | Petr&#x27;s Blog"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="https://raw.githubusercontent.com/cncf/artwork/40e2e8948509b40e4bad479446aaec18d6273bf2/projects/kubernetes/icon/color/kubernetes-icon-color.svg"><link data-rh="true" rel="canonical" href="https://blog-test.ruzicka.dev/docosaurus-test/blog"><link data-rh="true" rel="alternate" href="https://blog-test.ruzicka.dev/docosaurus-test/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog-test.ruzicka.dev/docosaurus-test/blog" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog","mainEntityOfPage":"https://blog-test.ruzicka.dev/docosaurus-test/blog","headline":"Blog","description":"Blog","blogPost":[{"@type":"BlogPosting","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog/first-post","mainEntityOfPage":"https://blog-test.ruzicka.dev/docosaurus-test/blog/first-post","url":"https://blog-test.ruzicka.dev/docosaurus-test/blog/first-post","headline":"First_post","name":"First_post","description":"Test123 description","datePublished":"2021-10-03T00:00:00.000Z","author":{"@type":"Person","name":"Petr Ruzicka","description":"Blog owner","url":"https://petr.ruzicka.dev","image":"https://github.com/ruzickap.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog/welcome","mainEntityOfPage":"https://blog-test.ruzicka.dev/docosaurus-test/blog/welcome","url":"https://blog-test.ruzicka.dev/docosaurus-test/blog/welcome","headline":"Welcome","name":"Welcome","description":"Docusaurus blogging features are powered by the blog plugin.","datePublished":"2021-08-26T00:00:00.000Z","author":[{"@type":"Person","name":"Sébastien Lorber","description":"Docusaurus maintainer","url":"https://sebastienlorber.com","image":"https://github.com/slorber.png"},{"@type":"Person","name":"Yangshun Tay","description":"Front End Engineer @ Facebook","url":"https://github.com/yangshun","image":"https://github.com/yangshun.png"}],"keywords":[]},{"@type":"BlogPosting","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog/mdx-blog-post","mainEntityOfPage":"https://blog-test.ruzicka.dev/docosaurus-test/blog/mdx-blog-post","url":"https://blog-test.ruzicka.dev/docosaurus-test/blog/mdx-blog-post","headline":"MDX Blog Post","name":"MDX Blog Post","description":"Blog posts support Docusaurus Markdown features, such as MDX.","datePublished":"2021-08-01T00:00:00.000Z","author":{"@type":"Person","name":"Sébastien Lorber","description":"Docusaurus maintainer","url":"https://sebastienlorber.com","image":"https://github.com/slorber.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post","mainEntityOfPage":"https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post","url":"https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post","headline":"Test EKS Post","name":"Test EKS Post","description":"![Amazon EKS](https://raw.githubusercontent.com/cncf/landscape/7f5b02ecba914a32912e77fc78e1c54d1c2f98ec/hosted_logos/amazon-eks.svg?sanitize=true","datePublished":"2020-12-10T00:00:00.000Z","author":{"@type":"Person","name":"Petr Ruzicka","description":"Blog owner","url":"https://petr.ruzicka.dev","image":"https://github.com/ruzickap.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog/image-test-eks-post","mainEntityOfPage":"https://blog-test.ruzicka.dev/docosaurus-test/blog/image-test-eks-post","url":"https://blog-test.ruzicka.dev/docosaurus-test/blog/image-test-eks-post","headline":"Image Test EKS Post","name":"Image Test EKS Post","description":"Keycloak","datePublished":"2020-12-01T00:00:00.000Z","author":{"@type":"Person","name":"Petr Ruzicka","description":"Blog owner","url":"https://petr.ruzicka.dev","image":"https://github.com/ruzickap.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog/long-blog-post","mainEntityOfPage":"https://blog-test.ruzicka.dev/docosaurus-test/blog/long-blog-post","url":"https://blog-test.ruzicka.dev/docosaurus-test/blog/long-blog-post","headline":"Long Blog Post","name":"Long Blog Post","description":"This is the summary of a very long blog post,","datePublished":"2019-05-29T00:00:00.000Z","author":{"@type":"Person","name":"Endilie Yacop Sucipto","description":"Maintainer of Docusaurus","url":"https://github.com/endiliey","image":"https://github.com/endiliey.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog/first-blog-post","mainEntityOfPage":"https://blog-test.ruzicka.dev/docosaurus-test/blog/first-blog-post","url":"https://blog-test.ruzicka.dev/docosaurus-test/blog/first-blog-post","headline":"First Blog Post","name":"First Blog Post","description":"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet","datePublished":"2019-05-28T00:00:00.000Z","author":{"@type":"Person","name":"Gao Wei","description":"Docusaurus Core Team","url":"https://github.com/wgao19","image":"https://github.com/wgao19.png"},"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/docosaurus-test/blog/rss.xml" title="Petr&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docosaurus-test/blog/atom.xml" title="Petr&#39;s Blog Atom Feed"><link rel="stylesheet" href="/docosaurus-test/assets/css/styles.2d3f038e.css">
<script src="/docosaurus-test/assets/js/runtime~main.2e84ab3f.js" defer="defer"></script>
<script src="/docosaurus-test/assets/js/main.7c492edf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docosaurus-test/"><div class="navbar__logo"><img src="https://raw.githubusercontent.com/cncf/artwork/40e2e8948509b40e4bad479446aaec18d6273bf2/projects/networkservicemesh/icon/color/networkservicemesh-icon-color-reversed.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://raw.githubusercontent.com/cncf/artwork/40e2e8948509b40e4bad479446aaec18d6273bf2/projects/networkservicemesh/icon/color/networkservicemesh-icon-color-reversed.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Petr&#x27;s Blog</b></a><a class="navbar__item navbar__link" href="/docosaurus-test/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docosaurus-test/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docosaurus-test/blog/first-post">First_post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docosaurus-test/blog/welcome">Welcome</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docosaurus-test/blog/mdx-blog-post">MDX Blog Post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docosaurus-test/blog/test-eks-post">Test EKS Post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docosaurus-test/blog/image-test-eks-post">Image Test EKS Post</a></li></ul></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/docosaurus-test/blog/first-post">First_post</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-10-03T00:00:00.000Z">October 3, 2021</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://petr.ruzicka.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ruzickap.png" alt="Petr Ruzicka"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://petr.ruzicka.dev" target="_blank" rel="noopener noreferrer"><span>Petr Ruzicka</span></a></div><small class="avatar__subtitle">Blog owner</small></div></div></div></div></header><div class="markdown"><p>Test 123</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">Resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;arn:aws:secretsmanager:*:*:secret:*&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/first">first</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/first-post">first_post</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/docosaurus-test/blog/welcome">Welcome</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-08-26T00:00:00.000Z">August 26, 2021</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://sebastienlorber.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/slorber.png" alt="Sébastien Lorber"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://sebastienlorber.com" target="_blank" rel="noopener noreferrer"><span>Sébastien Lorber</span></a></div><small class="avatar__subtitle">Docusaurus maintainer</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/yangshun" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/yangshun.png" alt="Yangshun Tay"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/yangshun" target="_blank" rel="noopener noreferrer"><span>Yangshun Tay</span></a></div><small class="avatar__subtitle">Front End Engineer @ Facebook</small></div></div></div></div></header><div class="markdown"><p><a href="https://docusaurus.io/docs/blog" target="_blank" rel="noopener noreferrer">Docusaurus blogging features</a> are powered by the <a href="https://docusaurus.io/docs/api/plugins/@docusaurus/plugin-content-blog" target="_blank" rel="noopener noreferrer">blog plugin</a>.</p>
<p>Simply add Markdown files (or folders) to the <code>blog</code> directory.</p>
<p>Regular blog authors can be added to <code>authors.yml</code>.</p>
<p>The blog post date can be extracted from filenames, such as:</p>
<ul>
<li><code>2019-05-30-welcome.md</code></li>
<li><code>2019-05-30-welcome/index.md</code></li>
</ul>
<p>A blog post folder can be convenient to co-locate blog post images:</p>
<p><img decoding="async" loading="lazy" alt="Docusaurus Plushie" src="/docosaurus-test/assets/images/docusaurus-plushie-banner-a60f7593abca1e3eef26a9afa244e4fb.jpeg" width="1500" height="500" class="img_ev3q"></p>
<p>The blog supports tags as well!</p>
<p><strong>And if you don&#x27;t want a blog</strong>: just delete this directory, and use <code>blog: false</code> in your Docusaurus config.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/facebook">facebook</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/hello">hello</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/docusaurus">docusaurus</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/docosaurus-test/blog/mdx-blog-post">MDX Blog Post</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-08-01T00:00:00.000Z">August 1, 2021</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://sebastienlorber.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/slorber.png" alt="Sébastien Lorber"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://sebastienlorber.com" target="_blank" rel="noopener noreferrer"><span>Sébastien Lorber</span></a></div><small class="avatar__subtitle">Docusaurus maintainer</small></div></div></div></div></header><div class="markdown"><p>Blog posts support <a href="https://docusaurus.io/docs/markdown-features" target="_blank" rel="noopener noreferrer">Docusaurus Markdown features</a>, such as <a href="https://mdxjs.com/" target="_blank" rel="noopener noreferrer">MDX</a>.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Use the power of React to create interactive blog posts.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">button onClick</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">alert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;button clicked!&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token maybe-class-name">Click</span><span class="token plain"> me</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">button</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><button>Click me!</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/docusaurus">docusaurus</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/docosaurus-test/blog/test-eks-post">Test EKS Post</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-12-10T00:00:00.000Z">December 10, 2020</time> · <!-- -->22 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://petr.ruzicka.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ruzickap.png" alt="Petr Ruzicka"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://petr.ruzicka.dev" target="_blank" rel="noopener noreferrer"><span>Petr Ruzicka</span></a></div><small class="avatar__subtitle">Blog owner</small></div></div></div></div></header><div class="markdown"><p><img decoding="async" loading="lazy" src="https://raw.githubusercontent.com/cncf/landscape/7f5b02ecba914a32912e77fc78e1c54d1c2f98ec/hosted_logos/amazon-eks.svg?sanitize=true" alt="Amazon EKS" title="Amazon EKS" class="img_ev3q"></p>
<p>Before starting with the main content, it&#x27;s necessary to provision
the <a href="https://aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer">Amazon EKS</a> in AWS.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements" href="/docosaurus-test/blog#requirements">​</a></h2>
<p>If you would like to follow this documents and it&#x27;s task you will need to set up
few environment variables.</p>
<p>The <code>LETSENCRYPT_ENVIRONMENT</code> variable should be one of:</p>
<ul>
<li><code>staging</code> - Let’s Encrypt will create testing certificate (not valid)</li>
<li><code>production</code> - Let’s Encrypt will create valid certificate (use with care)</li>
</ul>
<p><code>BASE_DOMAIN</code> contains DNS records for all your Kubernetes clusters. The cluster
names will look like <code>CLUSTER_NAME</code>.<code>BASE_DOMAIN</code> (<code>kube1.k8s.mylabs.dev</code>).</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Hostname / FQDN definitions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_DOMAIN=${BASE_DOMAIN:-k8s.mylabs.dev}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export CLUSTER_NAME=${CLUSTER_NAME:-kube1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export CLUSTER_FQDN=&quot;${CLUSTER_NAME}.${BASE_DOMAIN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export KUBECONFIG=${PWD}/kubeconfig-${CLUSTER_NAME}.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># * &quot;production&quot; - valid certificates signed by Lets Encrypt &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># * &quot;staging&quot; - not trusted certs signed by Lets Encrypt &quot;Fake LE Intermediate X1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export LETSENCRYPT_ENVIRONMENT=&quot;staging&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export LETSENCRYPT_CERTIFICATE=&quot;https://letsencrypt.org/certs/staging/letsencrypt-stg-root-x1.pem&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># export LETSENCRYPT_ENVIRONMENT=&quot;production&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># export LETSENCRYPT_CERTIFICATE=&quot;https://letsencrypt.org/certs/lets-encrypt-r3.pem&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_EMAIL=&quot;petr.ruzicka@gmail.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GitHub Organization + Team where are the users who will have the admin access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># to K8s resources (Grafana). Only users in GitHub organization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (MY_GITHUB_ORG_NAME) will be able to access the apps via ingress.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_NAME=&quot;ruzickap-org&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_USERNAME=&quot;ruzickap&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># AWS Region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AWS_DEFAULT_REGION=&quot;eu-west-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SLACK_CHANNEL=&quot;mylabs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tags used to tag the AWS resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export TAGS=&quot;Owner=${MY_EMAIL} Environment=Dev Group=Cloud_Native Squad=Cloud_Container_Platform compliance:na:defender=bottlerocket&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e &quot;${MY_EMAIL} | ${LETSENCRYPT_ENVIRONMENT} | ${CLUSTER_NAME} | ${BASE_DOMAIN} | ${CLUSTER_FQDN}\n${TAGS}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Prepare GitHub OAuth &quot;access&quot; credentials ans AWS &quot;access&quot; variables.</p>
<p>You will need to configure AWS CLI: <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html" target="_blank" rel="noopener noreferrer">Configuring the AWS CLI</a></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Common password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_PASSWORD=&quot;xxxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># AWS Credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AWS_ACCESS_KEY_ID=&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AWS_SECRET_ACCESS_KEY=&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AWS_CONSOLE_ADMIN_ROLE_ARN=&quot;arn:aws:iam::7xxxxxxxxxx7:role/xxxxxxxxxxxxxN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GitHub Organization OAuth Apps credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID=&quot;3xxxxxxxxxxxxxxxxxx3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET=&quot;7xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID=&quot;4xxxxxxxxxxxxxxxxxx4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET=&quot;7xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Sysdig credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SYSDIG_AGENT_ACCESSKEY=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Aqua credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AQUA_REGISTRY_USERNAME=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AQUA_REGISTRY_PASSWORD=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AQUA_ENFORCER_TOKEN=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Splunk credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SPLUNK_HOST=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SPLUNK_TOKEN=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SPLUNK_INDEX_NAME=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Slack incoming webhook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SLACK_INCOMING_WEBHOOK_URL=&quot;https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SLACK_BOT_API_TOKEN=&quot;xxxx-xxxxxxxxxxxxx-xxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Okta configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export OKTA_ISSUER=&quot;https://exxxxxxx-xxxxx-xx.okta.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export OKTA_CLIENT_ID=&quot;0xxxxxxxxxxxxxxxxxx7&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export OKTA_CLIENT_SECRET=&quot;1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxH&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Verify if all the necessary variables were set:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">case &quot;${CLUSTER_NAME}&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kube1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID=${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID:-${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID_KUBE1}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET=${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET:-${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET_KUBE1}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID=${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID:-${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID_KUBE1}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET=${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET:-${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET_KUBE1}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kube2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID=${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID:-${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID_KUBE2}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET=${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET:-${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET_KUBE2}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID=${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID:-${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID_KUBE2}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET=${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET:-${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET_KUBE2}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Unsupported cluster name: ${CLUSTER_NAME} !&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">esac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${AWS_ACCESS_KEY_ID?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${AWS_SECRET_ACCESS_KEY?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${AWS_CONSOLE_ADMIN_ROLE_ARN?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${GITHUB_TOKEN?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${SLACK_INCOMING_WEBHOOK_URL?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${SLACK_BOT_API_TOKEN?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${MY_PASSWORD?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${OKTA_ISSUER?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${OKTA_CLIENT_ID?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${OKTA_CLIENT_SECRET?}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-the-local-working-environment">Prepare the local working environment<a class="hash-link" aria-label="Direct link to Prepare the local working environment" title="Direct link to Prepare the local working environment" href="/docosaurus-test/blog#prepare-the-local-working-environment">​</a></h2>
<p>::: tip
You can skip these steps if you have all the required software already
installed.
:::</p>
<p>Install necessary software:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if command -v apt-get &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apt update -qq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DEBIAN_FRONTEND=noninteractive apt-get install -y -qq apache2-utils ansible dnsutils git gnupg2 jq sudo unzip &gt; /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer">AWS CLI</a>  binary:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v aws &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -sL &quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot; -o &quot;/tmp/awscliv2.zip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unzip -q -o /tmp/awscliv2.zip -d /tmp/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo /tmp/aws/install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/kubernetes/kubectl" target="_blank" rel="noopener noreferrer">kubectl</a> binary:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v kubectl &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # https://github.com/kubernetes/kubectl/releases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/kubectl &quot;https://storage.googleapis.com/kubernetes-release/release/v1.21.1/bin/$(uname | sed &quot;s/./\L&amp;/g&quot;)/amd64/kubectl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v helm &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # https://github.com/helm/helm/releases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s https://raw.githubusercontent.com/helm/helm/master/scripts/get | bash -s -- --version v3.6.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://eksctl.io/" target="_blank" rel="noopener noreferrer">eksctl</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v eksctl &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # https://github.com/weaveworks/eksctl/releases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s -L &quot;https://github.com/weaveworks/eksctl/releases/download/0.60.0/eksctl_$(uname)_amd64.tar.gz&quot; | sudo tar xz -C /usr/local/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/kubernetes-sigs/aws-iam-authenticator" target="_blank" rel="noopener noreferrer">AWS IAM Authenticator for Kubernetes</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v aws-iam-authenticator &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # https://docs.aws.amazon.com/eks/latest/userguide/install-aws-iam-authenticator.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/aws-iam-authenticator &quot;https://amazon-eks.s3.us-west-2.amazonaws.com/1.19.6/2021-01-05/bin/$(uname | sed &quot;s/./\L&amp;/g&quot;)/amd64/aws-iam-authenticator&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/aws-iam-authenticator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://www.vaultproject.io/downloads" target="_blank" rel="noopener noreferrer">vault</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v vault &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s -L &quot;https://releases.hashicorp.com/vault/1.7.2/vault_1.7.2_$(uname | sed &quot;s/./\L&amp;/g&quot;)_amd64.zip&quot; -o /tmp/vault.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo unzip -q /tmp/vault.zip -d /usr/local/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rm /tmp/vault.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/vmware-tanzu/velero/releases" target="_blank" rel="noopener noreferrer">velero</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v velero &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s -L &quot;https://github.com/vmware-tanzu/velero/releases/download/v1.6.0/velero-v1.6.0-$(uname | sed &quot;s/./\L&amp;/g&quot;)-amd64.tar.gz&quot; -o /tmp/velero.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo tar xzf /tmp/velero.tar.gz -C /usr/local/bin/ --strip-components 1 &quot;velero-v1.6.0-$(uname | sed &quot;s/./\L&amp;/g&quot;)-amd64/velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://toolkit.fluxcd.io/" target="_blank" rel="noopener noreferrer">flux</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v flux &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s https://fluxcd.io/install.sh | sudo bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <code>calicoctl</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v calicoctl &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/calicoctl https://github.com/projectcalico/calicoctl/releases/download/v3.20.0/calicoctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/calicoctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/mozilla/sops" target="_blank" rel="noopener noreferrer">SOPS: Secrets OPerationS</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v sops &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/sops &quot;https://github.com/mozilla/sops/releases/download/v3.7.1/sops-v3.7.1.$(uname | sed &quot;s/./\L&amp;/g&quot;)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/sops</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://kustomize.io/" target="_blank" rel="noopener noreferrer">kustomize</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v kustomize &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s &quot;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&quot; | sudo bash -s 4.1.2 /usr/local/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/rakyll/hey" target="_blank" rel="noopener noreferrer">hey</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v hey &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/hey &quot;https://hey-release.s3.us-east-2.amazonaws.com/hey_$(uname | sed &quot;s/./\L&amp;/g&quot;)_amd64&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/hey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-aws-route-53-domain-delegation">Configure AWS Route 53 Domain delegation<a class="hash-link" aria-label="Direct link to Configure AWS Route 53 Domain delegation" title="Direct link to Configure AWS Route 53 Domain delegation" href="/docosaurus-test/blog#configure-aws-route-53-domain-delegation">​</a></h2>
<p>Create DNS zone (<code>BASE_DOMAIN</code>):</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws route53 create-hosted-zone --output json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name &quot;${BASE_DOMAIN}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --caller-reference &quot;$(date)&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --hosted-zone-config=&quot;{\&quot;Comment\&quot;: \&quot;Created by ${MY_EMAIL}\&quot;, \&quot;PrivateZone\&quot;: false}&quot; | jq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use your domain registrar to change the nameservers for your zone (for example
&quot;mylabs.dev&quot;) to use the Amazon Route 53 nameservers. Here is the way how you
can find out the the Route 53 nameservers:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NEW_ZONE_ID=$(aws route53 list-hosted-zones --query &quot;HostedZones[?Name==\`${BASE_DOMAIN}.\`].Id&quot; --output text)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NEW_ZONE_NS=$(aws route53 get-hosted-zone --output json --id &quot;${NEW_ZONE_ID}&quot; --query &quot;DelegationSet.NameServers&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NEW_ZONE_NS1=$(echo &quot;${NEW_ZONE_NS}&quot; | jq -r &quot;.[0]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NEW_ZONE_NS2=$(echo &quot;${NEW_ZONE_NS}&quot; | jq -r &quot;.[1]&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create the NS record in <code>k8s.mylabs.dev</code> (<code>BASE_DOMAIN</code>) for proper zone
delegation. This step depends on your domain registrar - I&#x27;m using CloudFlare
and using Ansible to automate it:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ansible -m cloudflare_dns -c local -i &quot;localhost,&quot; localhost -a &quot;zone=mylabs.dev record=${BASE_DOMAIN} type=NS value=${NEW_ZONE_NS1} solo=true proxied=no account_email=${CLOUDFLARE_EMAIL} account_api_token=${CLOUDFLARE_API_KEY}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ansible -m cloudflare_dns -c local -i &quot;localhost,&quot; localhost -a &quot;zone=mylabs.dev record=${BASE_DOMAIN} type=NS value=${NEW_ZONE_NS2} solo=false proxied=no account_email=${CLOUDFLARE_EMAIL} account_api_token=${CLOUDFLARE_API_KEY}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost | CHANGED =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ansible_facts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;changed&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;result&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;record&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;content&quot;: &quot;ns-885.awsdns-46.net&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;created_on&quot;: &quot;2020-11-13T06:25:32.18642Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;id&quot;: &quot;dxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;locked&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;meta&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;auto_added&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;managed_by_apps&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;managed_by_argo_tunnel&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;source&quot;: &quot;primary&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;modified_on&quot;: &quot;2020-11-13T06:25:32.18642Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;name&quot;: &quot;k8s.mylabs.dev&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;proxiable&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;proxied&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ttl&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;type&quot;: &quot;NS&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;zone_id&quot;: &quot;2xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxe&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;zone_name&quot;: &quot;mylabs.dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localhost | CHANGED =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ansible_facts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;changed&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;result&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;record&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;content&quot;: &quot;ns-1692.awsdns-19.co.uk&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;created_on&quot;: &quot;2020-11-13T06:25:37.605605Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;id&quot;: &quot;9xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;locked&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;meta&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;auto_added&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;managed_by_apps&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;managed_by_argo_tunnel&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;source&quot;: &quot;primary&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;modified_on&quot;: &quot;2020-11-13T06:25:37.605605Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;name&quot;: &quot;k8s.mylabs.dev&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;proxiable&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;proxied&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ttl&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;type&quot;: &quot;NS&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;zone_id&quot;: &quot;2xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxe&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;zone_name&quot;: &quot;mylabs.dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-new-domain-to-route-53-policies-s3-ebs">Add new domain to Route 53, Policies, S3, EBS<a class="hash-link" aria-label="Direct link to Add new domain to Route 53, Policies, S3, EBS" title="Direct link to Add new domain to Route 53, Policies, S3, EBS" href="/docosaurus-test/blog#add-new-domain-to-route-53-policies-s3-ebs">​</a></h2>
<p>Details with examples are described on these links:</p>
<ul>
<li><a href="https://aws.amazon.com/blogs/opensource/introducing-fine-grained-iam-roles-service-accounts/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/blogs/opensource/introducing-fine-grained-iam-roles-service-accounts/</a></li>
<li><a href="https://cert-manager.io/docs/configuration/acme/dns01/route53/" target="_blank" rel="noopener noreferrer">https://cert-manager.io/docs/configuration/acme/dns01/route53/</a></li>
<li><a href="https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md</a></li>
</ul>
<p>Create CloudFormation template containing policies for Route53, S3 access
(Harbor, Velero) and Domain. Put new domain <code>CLUSTER_FQDN</code> to the Route 53 and
configure the DNS delegation from the <code>BASE_DOMAIN</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -vp &quot;tmp/${CLUSTER_FQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; &quot;tmp/${CLUSTER_FQDN}/aws-route53-iam-s3-kms-asm.yml&quot; &lt;&lt; \EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description: &quot;Template to generate the necessary IAM Policies for access to Route53 and S3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ClusterFQDN:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: &quot;Cluster domain where all necessary app subdomains will live (subdomain of BaseDomain). Ex: kube1.k8s.mylabs.dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ClusterName:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: &quot;Cluster Name Ex: kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BaseDomain:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: &quot;Base domain where cluster domains + their subdomains will live. Ex: k8s.mylabs.dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # This AWS control checks whether the status of the AWS Systems Manager association compliance is COMPLIANT or NON_COMPLIANT after the association is executed on an instance.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ConfigRule:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: &quot;AWS::Config::ConfigRule&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ConfigRuleName: !Sub &quot;${ClusterName}-ec2-managedinstance-association-compliance-status-check&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Scope:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ComplianceResourceTypes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;AWS::SSM::AssociationCompliance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: &quot;A Config rule that checks whether the compliance status of the Amazon EC2 Systems Manager association compliance is COMPLIANT or NON_COMPLIANT after the association execution on the instance. The rule is compliant if the field status is COMPLIANT.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Source:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Owner: &quot;AWS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SourceIdentifier: &quot;EC2_MANAGEDINSTANCE_ASSOCIATION_COMPLIANCE_STATUS_CHECK&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CloudWatchPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::ManagedPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ManagedPolicyName: !Sub &quot;${ClusterFQDN}-CloudWatch&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;Policy required by Fargate to log to CloudWatch for ${ClusterFQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - logs:CreateLogStream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - logs:CreateLogGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - logs:DescribeLogStreams</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - logs:PutLogEvents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HostedZone:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Route53::HostedZone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name: !Ref ClusterFQDN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KMSAlias:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::KMS::Alias</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AliasName: !Sub &quot;alias/eks-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TargetKeyId: !Ref KMSKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KMSKey:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::KMS::Key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;KMS key for secrets related to ${ClusterFQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      EnableKeyRotation: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PendingWindowInDays: 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      KeyPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Id: !Sub &quot;eks-key-policy-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: Enable IAM User Permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:root&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action: kms:*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: Allow use of the key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:role/aws-service-role/autoscaling.amazonaws.com/AWSServiceRoleForAutoScaling&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Encrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Decrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:ReEncrypt*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:GenerateDataKey*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:DescribeKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: Allow attachment of persistent resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:role/aws-service-role/autoscaling.amazonaws.com/AWSServiceRoleForAutoScaling&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:CreateGrant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Condition:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Bool:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              kms:GrantIsForAWSResource: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EKSViewNodesAndWorkloadsPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::ManagedPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ManagedPolicyName: !Sub &quot;${ClusterFQDN}-EKSViewNodesAndWorkloads&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;Policy used to view workloads running in an EKS cluster created using CAPA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:DescribeNodegroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:ListNodegroups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:DescribeCluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:ListClusters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:AccessKubernetesApi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ssm:GetParameter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:ListUpdates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:ListFargateProfiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RecordSet:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Route53::RecordSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HostedZoneName: !Sub &quot;${BaseDomain}.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name: !Ref ClusterFQDN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Type: NS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TTL: 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ResourceRecords: !GetAtt HostedZone.NameServers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  S3Policy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::ManagedPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ManagedPolicyName: !Sub &quot;${ClusterFQDN}-AmazonS3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;Policy required by Harbor and Velero to write to S3 bucket ${ClusterFQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:ListBucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:GetBucketLocation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:ListBucketMultipartUploads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: !GetAtt S3Bucket.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:PutObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:GetObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:DeleteObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:ListMultipartUploadParts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:AbortMultipartUpload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: !Sub &quot;arn:aws:s3:::${ClusterFQDN}/*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  S3Bucket:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::S3::Bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AccessControl: Private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      BucketName: !Sub &quot;${ClusterFQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      BucketEncryption:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ServerSideEncryptionConfiguration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ServerSideEncryptionByDefault:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              SSEAlgorithm: AES256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecretsManagerMySecret:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::SecretsManager::Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name: !Sub &quot;${ClusterFQDN}-MySecret&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: My Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      GenerateSecretString:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SecretStringTemplate: &quot;{\&quot;username\&quot;: \&quot;Administrator\&quot;}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GenerateStringKey: password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PasswordLength: 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      KmsKeyId: !Ref KMSKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecretsManagerMySecret2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::SecretsManager::Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name: !Sub &quot;${ClusterFQDN}-MySecret2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: My Secret2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      GenerateSecretString:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SecretStringTemplate: &quot;{\&quot;username\&quot;: \&quot;Administrator2\&quot;}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GenerateStringKey: password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PasswordLength: 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      KmsKeyId: !Ref KMSKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UserMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserName: !Sub &quot;myuser1-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Policies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - PolicyName: !Sub &quot;myuser1-${ClusterName}-policy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - Sid: AllowAssumeOrganizationAccountRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Action: sts:AssumeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Resource: !GetAtt RoleMyUser1.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AccessKeyMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::AccessKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserName: !Ref UserMyUser1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RoleMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;IAM role for the myuser1-${ClusterName} user&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RoleName: !Sub &quot;myuser1-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AssumeRolePolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:root&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action: sts:AssumeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UserMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserName: !Sub &quot;myuser2-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Policies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - PolicyName: !Sub &quot;myuser2-${ClusterName}-policy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - Sid: AllowAssumeOrganizationAccountRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Action: sts:AssumeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Resource: !GetAtt RoleMyUser2.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AccessKeyMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::AccessKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserName: !Ref UserMyUser2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RoleMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;IAM role for the myuser2-${ClusterName} user&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RoleName: !Sub &quot;myuser2-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AssumeRolePolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:root&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action: sts:AssumeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Outputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CloudWatchPolicyArn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the created CloudWatchPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref CloudWatchPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-CloudWatchPolicyArn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KMSKeyArn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the created KMS Key to encrypt EKS related services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt KMSKey.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-KMSKeyArn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KMSKeyId:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ID of the created KMS Key to encrypt EKS related services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref KMSKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-KMSKeyId&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HostedZoneArn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the created Route53 Zone for K8s cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref HostedZone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-HostedZoneArn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  S3PolicyArn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the created AmazonS3 policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref S3Policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-S3PolicyArn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RoleMyUser1Arn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the MyUser1 IAM Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt RoleMyUser1.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-RoleMyUser1Arn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AccessKeyMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The AccessKey for MyUser1 user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref AccessKeyMyUser1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-AccessKeyMyUser1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecretAccessKeyMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The SecretAccessKey for MyUser1 user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt AccessKeyMyUser1.SecretAccessKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-SecretAccessKeyMyUser1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RoleMyUser2Arn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the MyUser2 IAM Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt RoleMyUser2.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-RoleMyUser2Arn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AccessKeyMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The AccessKey for MyUser2 user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref AccessKeyMyUser2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-AccessKeyMyUser2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecretAccessKeyMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The SecretAccessKey for MyUser2 user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt AccessKeyMyUser2.SecretAccessKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-SecretAccessKeyMyUser2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eval aws cloudformation deploy --capabilities CAPABILITY_NAMED_IAM \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --parameter-overrides &quot;ClusterFQDN=${CLUSTER_FQDN} ClusterName=${CLUSTER_NAME} BaseDomain=${BASE_DOMAIN}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --stack-name &quot;${CLUSTER_NAME}-route53-iam-s3-kms-asm&quot; --template-file &quot;tmp/${CLUSTER_FQDN}/aws-route53-iam-s3-kms-asm.yml&quot; --tags &quot;${TAGS}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AWS_CLOUDFORMATION_DETAILS=$(aws cloudformation describe-stacks --stack-name &quot;${CLUSTER_NAME}-route53-iam-s3-kms-asm&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CLOUDWATCH_POLICY_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;CloudWatchPolicyArn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KMS_KEY_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;KMSKeyArn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KMS_KEY_ID=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;KMSKeyId\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S3_POLICY_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;S3PolicyArn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER1_ROLE_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;RoleMyUser1Arn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER1_USER_ACCESSKEYMYUSER=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;AccessKeyMyUser1\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER1_USER_SECRETACCESSKEY=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;SecretAccessKeyMyUser1\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER2_ROLE_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;RoleMyUser2Arn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER2_USER_ACCESSKEYMYUSER=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;AccessKeyMyUser2\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER2_USER_SECRETACCESSKEY=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;SecretAccessKeyMyUser2\&quot;) .OutputValue&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Change TTL=60 of SOA + NS records for new domain
(it can not be done in CloudFormation):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HOSTED_ZONE_ID=$(aws route53 list-hosted-zones --query &quot;HostedZones[?Name==\`${CLUSTER_FQDN}.\`].Id&quot; --output text)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RESOURCE_RECORD_SET_SOA=$(aws route53 --output json list-resource-record-sets --hosted-zone-id &quot;${HOSTED_ZONE_ID}&quot; --query &quot;(ResourceRecordSets[?Type == \`SOA\`])[0]&quot; | sed &quot;s/\&quot;TTL\&quot;:.*/\&quot;TTL\&quot;: 60,/&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RESOURCE_RECORD_SET_NS=$(aws route53 --output json list-resource-record-sets --hosted-zone-id &quot;${HOSTED_ZONE_ID}&quot; --query &quot;(ResourceRecordSets[?Type == \`NS\`])[0]&quot; | sed &quot;s/\&quot;TTL\&quot;:.*/\&quot;TTL\&quot;: 60,/&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt; EOF | aws route53 --output json change-resource-record-sets --hosted-zone-id &quot;${HOSTED_ZONE_ID}&quot; --change-batch=file:///dev/stdin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Comment&quot;: &quot;Update record to reflect new TTL for SOA and NS records&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Changes&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Action&quot;: &quot;UPSERT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ResourceRecordSet&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">${RESOURCE_RECORD_SET_SOA}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Action&quot;: &quot;UPSERT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ResourceRecordSet&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">${RESOURCE_RECORD_SET_NS}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-amazon-eks">Create Amazon EKS<a class="hash-link" aria-label="Direct link to Create Amazon EKS" title="Direct link to Create Amazon EKS" href="/docosaurus-test/blog#create-amazon-eks">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://raw.githubusercontent.com/aws-samples/eks-workshop/65b766c494a5b4f5420b2912d8373c4957163541/static/images/3-service-animated.gif" alt="EKS" title="EKS" class="img_ev3q"></p>
<p>Create <a href="https://aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer">Amazon EKS</a> in AWS by using <a href="https://eksctl.io/" target="_blank" rel="noopener noreferrer">eksctl</a>.
It&#x27;s a tool from Weaveworks based on official
AWS CloudFormation templates which will be used to launch and configure our
EKS cluster and nodes.</p>
<p><img decoding="async" loading="lazy" src="https://raw.githubusercontent.com/weaveworks/eksctl/c365149fc1a0b8d357139cbd6cda5aee8841c16c/logo/eksctl.png" alt="eksctl" title="eksctl" class="img_ev3q"></p>
<p>Generate SSH key if not exists:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test -f ~/.ssh/id_rsa.pub || (install -m 0700 -d ~/.ssh &amp;&amp; ssh-keygen -b 2048 -t rsa -f ~/.ssh/id_rsa -q -N &quot;&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create the Amazon EKS cluster with Calico using <code>eksctl</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; &quot;tmp/${CLUSTER_FQDN}/eksctl.yaml&quot; &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: eksctl.io/v1alpha5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: ${CLUSTER_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region: ${AWS_DEFAULT_REGION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version: &quot;1.21&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags: &amp;tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$(echo &quot;${TAGS}&quot; | sed &quot;s/ /\\n    /g; s/^/    /g; s/=/: /g&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">availabilityZones:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ${AWS_DEFAULT_REGION}a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ${AWS_DEFAULT_REGION}b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iam:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  withOIDC: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceAccounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: aws-load-balancer-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        awsLoadBalancerController: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: cert-manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: cert-manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        certManager: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: cluster-autoscaler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        autoScaler: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: external-dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: external-dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        externalDNS: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: ebs-csi-controller-sa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ebsCSIController: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: harbor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: harbor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - ${S3_POLICY_ARN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: velero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: velero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - ${S3_POLICY_ARN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: s3-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: s3-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - ${S3_POLICY_ARN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-prometheus-stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - arn:aws:iam::aws:policy/AmazonPrometheusQueryAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - arn:aws:iam::aws:policy/CloudWatchReadOnlyAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: AllowReadingTagsInstancesRegionsFromEC2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ec2:DescribeTags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ec2:DescribeInstances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ec2:DescribeRegions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: AllowReadingResourcesForTags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action: tag:GetResources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: kube-prometheus-stack-prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-prometheus-stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - arn:aws:iam::aws:policy/AmazonPrometheusQueryAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - arn:aws:iam::aws:policy/AmazonPrometheusRemoteWriteAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: efs-csi-controller-sa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        efsCSIController: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: VaultKMSUnseal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Encrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Decrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:DescribeKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;${KMS_KEY_ARN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: kuard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kuard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: AllowSecretManagerAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - secretsmanager:GetSecretValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - secretsmanager:DescribeSecret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;arn:aws:secretsmanager:*:*:secret:*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: AllowKMSAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Decrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;${KMS_KEY_ARN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vpc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nat:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gateway: Disable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">managedNodeGroups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: managed-ng-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    amiFamily: Bottlerocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instanceType: t3.xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instancePrefix: ruzickap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desiredCapacity: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    minSize: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxSize: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeSize: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      role: worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags: *tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iam:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      withAddonPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        autoScaler: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cloudWatch: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ebs: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        efs: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxPodsPerNode: 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeEncrypted: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeKmsKeyID: ${KMS_KEY_ID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fargateProfiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: fp-fgtest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selectors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - namespace: fgtest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags: *tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secretsEncryption:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  keyARN: ${KMS_KEY_ARN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudWatch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterLogging:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enableTypes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - authenticator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ! eksctl get clusters --name=&quot;${CLUSTER_NAME}&quot; &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eksctl create cluster --config-file &quot;tmp/${CLUSTER_FQDN}/eksctl.yaml&quot; --kubeconfig &quot;${KUBECONFIG}&quot; --without-nodegroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubectl delete daemonset -n kube-system aws-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubectl apply -f https://docs.projectcalico.org/archive/v3.20/manifests/calico-vxlan.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eksctl create nodegroup --config-file &quot;tmp/${CLUSTER_FQDN}/eksctl.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  eksctl version 0.75.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  using region eu-west-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  subnets for eu-west-1a - public:192.168.0.0/19 private:192.168.64.0/19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  subnets for eu-west-1b - public:192.168.32.0/19 private:192.168.96.0/19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  using Kubernetes version 1.21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  creating EKS cluster &quot;kube1&quot; in &quot;eu-west-1&quot; region with Fargate profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  will create a CloudFormation stack for cluster itself and 0 nodegroup stack(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  will create a CloudFormation stack for cluster itself and 0 managed nodegroup stack(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  if you encounter any issues, check CloudFormation console or try &#x27;eksctl utils describe-stacks --region=eu-west-1 --cluster=kube1&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  Kubernetes API endpoint access will use default of {publicAccess=true, privateAccess=false} for cluster &quot;kube1&quot; in &quot;eu-west-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 sequential tasks: { create cluster control plane &quot;kube1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    7 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wait for control plane to become ready,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tag cluster,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        update CloudWatch logging configuration,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        create fargate profiles,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        associate IAM OIDC provider,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        14 parallel sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/aws-load-balancer-controller&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/aws-load-balancer-controller&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;cert-manager/cert-manager&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;cert-manager/cert-manager&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/cluster-autoscaler&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/cluster-autoscaler&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;external-dns/external-dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;external-dns/external-dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/ebs-csi-controller-sa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/ebs-csi-controller-sa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;harbor/harbor&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;harbor/harbor&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;velero/velero&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;velero/velero&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;s3-test/s3-test&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;s3-test/s3-test&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-prometheus-stack/grafana&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-prometheus-stack/grafana&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-prometheus-stack/kube-prometheus-stack-prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-prometheus-stack/kube-prometheus-stack-prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/efs-csi-controller-sa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/efs-csi-controller-sa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;vault/vault&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;vault/vault&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kuard/kuard&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kuard/kuard&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/aws-node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/aws-node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        restart daemonset &quot;kube-system/aws-node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  building cluster stack &quot;eksctl-kube1-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [ℹ]  deploying stack &quot;eksctl-kube1-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:53:21 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:05:55 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:07:59 [✔]  tagged EKS cluster (Owner=petr.ruzicka@gmail.com, Squad=Cloud_Container_Platform, compliance:na:defender=bottlerocket, Environment=Dev, Group=Cloud_Native)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:08:00 [ℹ]  waiting for requested &quot;LoggingUpdate&quot; in cluster &quot;kube1&quot; to succeed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:08:53 [ℹ]  waiting for requested &quot;LoggingUpdate&quot; in cluster &quot;kube1&quot; to succeed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:08:54 [✔]  configured CloudWatch logging for cluster &quot;kube1&quot; in &quot;eu-west-1&quot; (enabled types: authenticator &amp; disabled types: api, audit, controllerManager, scheduler)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:08:54 [ℹ]  creating Fargate profile &quot;fp-fgtest&quot; on EKS cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:13:12 [ℹ]  created Fargate profile &quot;fp-fgtest&quot; on EKS cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [ℹ]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:00 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:00 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:01 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:02 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:02 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:02 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:02 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:03 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:03 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:03 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:04 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:04 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:04 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:05 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:17 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [ℹ]  created namespace &quot;harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [ℹ]  created serviceaccount &quot;harbor/harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [ℹ]  created namespace &quot;s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [ℹ]  created serviceaccount &quot;s3-test/s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:19 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:19 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:19 [ℹ]  created namespace &quot;velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:19 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:20 [ℹ]  created serviceaccount &quot;velero/velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:20 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:20 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [ℹ]  created namespace &quot;kube-prometheus-stack&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [ℹ]  created serviceaccount &quot;kube-prometheus-stack/kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [ℹ]  serviceaccount &quot;kube-system/aws-node&quot; already exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [ℹ]  updated serviceaccount &quot;kube-system/aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:35 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:36 [ℹ]  created serviceaccount &quot;kube-system/cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:37 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [ℹ]  created serviceaccount &quot;kube-prometheus-stack/grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [ℹ]  created namespace &quot;kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [ℹ]  created serviceaccount &quot;kuard/kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [ℹ]  created namespace &quot;vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [ℹ]  created serviceaccount &quot;vault/vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [ℹ]  created namespace &quot;cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [ℹ]  created serviceaccount &quot;cert-manager/cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [ℹ]  created serviceaccount &quot;kube-system/aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [ℹ]  created serviceaccount &quot;kube-system/ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:41 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:42 [ℹ]  created namespace &quot;external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:42 [ℹ]  created serviceaccount &quot;external-dns/external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:42 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [ℹ]  created serviceaccount &quot;kube-system/efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [ℹ]  daemonset &quot;kube-system/aws-node&quot; restarted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [ℹ]  waiting for the control plane availability...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [✔]  saved kubeconfig as &quot;/Users/ruzickap/git/k8s-eks-bottlerocket-fargate/kubeconfig-kube1.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [ℹ]  no tasks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [✔]  all EKS cluster resources for &quot;kube1&quot; have been created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:44 [ℹ]  kubectl command should work with &quot;/Users/ruzickap/git/k8s-eks-bottlerocket-fargate/kubeconfig-kube1.conf&quot;, try &#x27;kubectl --kubeconfig=/Users/ruzickap/git/k8s-eks-bottlerocket-fargate/kubeconfig-kube1.conf get nodes&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:44 [✔]  EKS cluster &quot;kube1&quot; in &quot;eu-west-1&quot; region is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps &quot;aws-node&quot; deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/calico-config created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/kubecontrollersconfigurations.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/calico-node created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/calico-node created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps/calico-node created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/calico-node created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Warning: policy/v1beta1 PodDisruptionBudget is deprecated in v1.21+, unavailable in v1.25+; use policy/v1 PodDisruptionBudget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">poddisruptionbudget.policy/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:59 [ℹ]  eksctl version 0.75.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:59 [ℹ]  using region eu-west-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:15 [ℹ]  nodegroup &quot;managed-ng-1&quot; will use &quot;&quot; [Bottlerocket/1.21]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:32 [ℹ]  1 nodegroup (managed-ng-1) was included (based on the include/exclude rules)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:32 [ℹ]  will create a CloudFormation stack for each of 1 managed nodegroups in cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:32 [ℹ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 sequential tasks: { fix cluster compatibility, 1 task: { 1 task: { create managed nodegroup &quot;managed-ng-1&quot; } }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:32 [ℹ]  checking cluster stack for missing resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:41 [ℹ]  cluster stack has all required resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:41 [ℹ]  building managed nodegroup stack &quot;eksctl-kube1-nodegroup-managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:41 [ℹ]  deploying stack &quot;eksctl-kube1-nodegroup-managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:41 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-nodegroup-managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:22:59 [ℹ]  waiting for CloudFormation stack &quot;eksctl-kube1-nodegroup-managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  no tasks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [✔]  created 0 nodegroup(s) in cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  nodegroup &quot;managed-ng-1&quot; has 3 node(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  node &quot;ip-192-168-31-11.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  node &quot;ip-192-168-56-82.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  node &quot;ip-192-168-60-184.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  waiting for at least 2 node(s) to become ready in &quot;managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  nodegroup &quot;managed-ng-1&quot; has 3 node(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  node &quot;ip-192-168-31-11.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  node &quot;ip-192-168-56-82.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [ℹ]  node &quot;ip-192-168-60-184.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [✔]  created 1 managed nodegroup(s) in cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:12 [ℹ]  checking security group configuration for all nodegroups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:12 [ℹ]  all nodegroups have up-to-date cloudformation templates</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When the cluster is ready it immediately start pushing logs to CloudWatch under
<code>/aws/eks/kube1/cluster</code>.</p>
<p>Add add the user or role to the aws-auth ConfigMap. This is handy if you are
using different user for cli operations and different user/role for accessing
the AWS Console to see EKS Workloads in Cluster&#x27;s tab.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! eksctl get iamidentitymapping --cluster=&quot;${CLUSTER_NAME}&quot; --region=&quot;${AWS_DEFAULT_REGION}&quot; --arn=${AWS_CONSOLE_ADMIN_ROLE_ARN}; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eksctl create iamidentitymapping --cluster=&quot;${CLUSTER_NAME}&quot; --region=&quot;${AWS_DEFAULT_REGION}&quot; --arn=&quot;${AWS_CONSOLE_ADMIN_ROLE_ARN}&quot; --group system:masters --username admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:13 [ℹ]  eksctl version 0.75.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:13 [ℹ]  using region eu-west-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:14 [ℹ]  adding identity &quot;arn:aws:iam::7xxxxxxxxxx7:role/AxxxxxxxxxxxxN&quot; to auth ConfigMap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Check the nodes+pods and max number of nodes which can be scheduled on one node:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes,pods -o wide --all-namespaces</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                STATUS   ROLES    AGE   VERSION   INTERNAL-IP      EXTERNAL-IP     OS-IMAGE                               KERNEL-VERSION   CONTAINER-RUNTIME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node/ip-192-168-31-11.eu-west-1.compute.internal    Ready    &lt;none&gt;   81s   v1.21.6   192.168.31.11    54.194.69.158   Bottlerocket OS 1.4.1 (aws-k8s-1.21)   5.10.68          containerd://1.5.5+bottlerocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node/ip-192-168-56-82.eu-west-1.compute.internal    Ready    &lt;none&gt;   86s   v1.21.6   192.168.56.82    3.250.52.238    Bottlerocket OS 1.4.1 (aws-k8s-1.21)   5.10.68          containerd://1.5.5+bottlerocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node/ip-192-168-60-184.eu-west-1.compute.internal   Ready    &lt;none&gt;   84s   v1.21.6   192.168.60.184   54.75.89.58     Bottlerocket OS 1.4.1 (aws-k8s-1.21)   5.10.68          containerd://1.5.5+bottlerocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE     NAME                                           READY   STATUS    RESTARTS   AGE     IP               NODE                                           NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/calico-kube-controllers-6c85b56fcb-5g5cq   1/1     Running   0          4m16s   172.16.166.130   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/calico-node-4whs8                          1/1     Running   0          84s     192.168.60.184   ip-192-168-60-184.eu-west-1.compute.internal   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/calico-node-nbjsn                          1/1     Running   0          86s     192.168.56.82    ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/calico-node-nnhwz                          1/1     Running   0          81s     192.168.31.11    ip-192-168-31-11.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/coredns-7cc879f8db-ct5bp                   1/1     Running   0          21m     172.16.166.131   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/coredns-7cc879f8db-h4mbs                   1/1     Running   0          21m     172.16.166.129   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/kube-proxy-9c9wk                           1/1     Running   0          86s     192.168.56.82    ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/kube-proxy-gqbt7                           1/1     Running   0          81s     192.168.31.11    ip-192-168-31-11.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/kube-proxy-q7pzh                           1/1     Running   0          84s     192.168.60.184   ip-192-168-60-184.eu-west-1.compute.internal   &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/eks">EKS</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/pipeline-templates">Pipeline Templates</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/docosaurus-test/blog/image-test-eks-post">Image Test EKS Post</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-12-01T00:00:00.000Z">December 1, 2020</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://petr.ruzicka.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ruzickap.png" alt="Petr Ruzicka"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://petr.ruzicka.dev" target="_blank" rel="noopener noreferrer"><span>Petr Ruzicka</span></a></div><small class="avatar__subtitle">Blog owner</small></div></div></div></div></header><div class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="keycloak">Keycloak<a class="hash-link" aria-label="Direct link to Keycloak" title="Direct link to Keycloak" href="/docosaurus-test/blog#keycloak">​</a></h2>
<p>Install <code>keycloak</code>
<a href="https://artifacthub.io/packages/helm/bitnami/keycloak" target="_blank" rel="noopener noreferrer">helm chart</a>
and modify the
<a href="https://github.com/bitnami/charts/blob/master/bitnami/keycloak/values.yaml" target="_blank" rel="noopener noreferrer">default values</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add --force-update bitnami https://charts.bitnami.com/bitnami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install --version 5.0.6 --namespace keycloak --create-namespace --values - keycloak bitnami/keycloak &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterDomain: ${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  adminUser: admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  adminPassword: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  managementUser: admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  managementPassword: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proxyAddressForwarding: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># https://stackoverflow.com/questions/51616770/keycloak-restricting-user-management-to-certain-groups-while-enabling-manage-us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extraStartupArgs: &quot;-Dkeycloak.profile.feature.admin_fine_grained_authz=enabled&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># keycloakConfigCli:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   # Workaround for bug: https://github.com/bitnami/charts/issues/6823</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   image:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     repository: adorsys/keycloak-config-cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     tag: latest-15.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     myrealm.yaml: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       realm: myrealm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       displayName: My Realm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       rememberMe: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       userManagedAccessAllowed: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       smtpServer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         from: myrealm-keycloak@${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         fromDisplayName: Keycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         host: mailhog.mailhog.svc.cluster.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         port: 1025</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       clients:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       # https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/oauth_provider/#keycloak-auth-provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - clientId: oauth2-proxy-keycloak.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         name: oauth2-proxy-keycloak.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         description: &quot;OAuth2 Proxy for Keycloak&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         secret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         redirectUris:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         - &quot;https://oauth2-proxy-keycloak.${CLUSTER_FQDN}/oauth2/callback&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         protocolMappers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         - name: groupMapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           protocol: openid-connect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           protocolMapper: oidc-group-membership-mapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#             userinfo.token.claim: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#             id.token.claim: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#             access.token.claim: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#             claim.name: groups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#             full.path: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       identityProviders:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       # https://ultimatesecurity.pro/post/okta-oidc/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - alias: keycloak-oidc-okta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         displayName: &quot;Okta&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         providerId: keycloak-oidc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         trustEmail: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           clientId: ${OKTA_CLIENT_ID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           clientSecret: ${OKTA_CLIENT_SECRET}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           tokenUrl: &quot;${OKTA_ISSUER}/oauth2/default/v1/token&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           authorizationUrl: &quot;${OKTA_ISSUER}/oauth2/default/v1/authorize&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           defaultScope: &quot;openid profile email&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           syncMode: IMPORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - alias: dex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         displayName: &quot;Dex&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         providerId: keycloak-oidc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         trustEmail: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           clientId: keycloak.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           clientSecret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           tokenUrl: https://dex.${CLUSTER_FQDN}/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           authorizationUrl: https://dex.${CLUSTER_FQDN}/auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           syncMode: IMPORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - alias: github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         displayName: &quot;Github&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         providerId: github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         trustEmail: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           clientId: ${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           clientSecret: ${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       users:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - username: myuser1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         email: myuser1@${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         firstName: My Firstname 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         lastName: My Lastname 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           - group-admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         credentials:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         - type: password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           value: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - username: myuser2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         email: myuser2@${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         firstName: My Firstname 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         lastName: My Lastname 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           - group-admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         credentials:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         - type: password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           value: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - username: myuser3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         email: myuser3@${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         firstName: My Firstname 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         lastName: My Lastname 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           - group-users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         credentials:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         - type: password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           value: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - username: myuser4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         email: myuser4@${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         firstName: My Firstname 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         lastName: My Lastname 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           - group-users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           - group-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         credentials:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         - type: password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#           value: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - name: group-users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - name: group-admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       - name: group-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hostname: keycloak.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  extraTls:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - keycloak.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secretName: ingress-cert-${LETSENCRYPT_ENVIRONMENT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">networkPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceMonitor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">postgresql:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  persistence:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="oauth2-proxy---keycloak">oauth2-proxy - Keycloak<a class="hash-link" aria-label="Direct link to oauth2-proxy - Keycloak" title="Direct link to oauth2-proxy - Keycloak" href="/docosaurus-test/blog#oauth2-proxy---keycloak">​</a></h2>
<p>Install <a href="https://github.com/oauth2-proxy/oauth2-proxy" target="_blank" rel="noopener noreferrer">oauth2-proxy</a> to secure
the endpoints like (<code>prometheus.</code>, <code>alertmanager.</code>).</p>
<p>Install <code>oauth2-proxy</code>
<a href="https://artifacthub.io/packages/helm/oauth2-proxy/oauth2-proxy" target="_blank" rel="noopener noreferrer">helm chart</a>
and modify the
<a href="https://github.com/oauth2-proxy/manifests/blob/main/helm/oauth2-proxy/values.yaml" target="_blank" rel="noopener noreferrer">default values</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add --force-update oauth2-proxy https://oauth2-proxy.github.io/manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install --version 4.2.0 --namespace oauth2-proxy-keycloak --create-namespace --values - oauth2-proxy oauth2-proxy/oauth2-proxy &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clientID: oauth2-proxy-keycloak.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clientSecret: &quot;${MY_PASSWORD}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cookieSecret: &quot;$(openssl rand -base64 32 | head -c 32 | base64)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  configFile: |-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email_domains = [ &quot;*&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    upstreams = [ &quot;file:///dev/null&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    whitelist_domains = &quot;.${CLUSTER_FQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cookie_domains = &quot;.${CLUSTER_FQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    provider = &quot;keycloak&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    login_url = &quot;https://keycloak.${CLUSTER_FQDN}/auth/realms/myrealm/protocol/openid-connect/auth&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    redeem_url = &quot;https://keycloak.${CLUSTER_FQDN}/auth/realms/myrealm/protocol/openid-connect/token&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    profile_url = &quot;https://keycloak.${CLUSTER_FQDN}/auth/realms/myrealm/protocol/openid-connect/userinfo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    validate_url = &quot;https://keycloak.${CLUSTER_FQDN}/auth/realms/myrealm/protocol/openid-connect/userinfo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scope = &quot;openid email profile&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_insecure_skip_verify = &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insecure_oidc_skip_issuer_verification = &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - oauth2-proxy-keycloak.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tls:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - secretName: ingress-cert-${LETSENCRYPT_ENVIRONMENT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - oauth2-proxy-keycloak.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  servicemonitor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dex">Dex<a class="hash-link" aria-label="Direct link to Dex" title="Direct link to Dex" href="/docosaurus-test/blog#dex">​</a></h2>
<p>Install <code>dex</code>
<a href="https://artifacthub.io/packages/helm/dex/dex" target="_blank" rel="noopener noreferrer">helm chart</a>
and modify the
<a href="https://github.com/dexidp/helm-charts/blob/master/charts/dex/values.yaml" target="_blank" rel="noopener noreferrer">default values</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add --force-update dex https://charts.dexidp.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install --version 0.6.0 --namespace dex --create-namespace --values - dex dex/dex &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx.ingress.kubernetes.io/ssl-redirect: &quot;false&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - host: dex.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - path: /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pathType: ImplementationSpecific</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tls:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - secretName: ingress-cert-${LETSENCRYPT_ENVIRONMENT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - dex.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  issuer: https://dex.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      inCluster: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oauth2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    skipApprovalScreen: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  connectors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - type: github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      id: github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: GitHub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clientID: ${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clientSecret: ${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        redirectURI: https://dex.${CLUSTER_FQDN}/callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orgs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - name: ${MY_GITHUB_ORG_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - type: oidc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      id: okta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: Okta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        issuer: ${OKTA_ISSUER}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clientID: ${OKTA_CLIENT_ID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clientSecret: ${OKTA_CLIENT_SECRET}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        redirectURI: https://dex.${CLUSTER_FQDN}/callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scopes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - openid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        getUserInfo: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  staticClients:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - id: argocd.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      redirectURIs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - https://argocd.${CLUSTER_FQDN}/auth/callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: ArgoCD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      secret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - id: gangway.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      redirectURIs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - https://gangway.${CLUSTER_FQDN}/callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: Gangway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      secret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - id: harbor.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      redirectURIs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - https://harbor.${CLUSTER_FQDN}/c/oidc/callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: Harbor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      secret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - id: kiali.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      redirectURIs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - https://kiali.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: Kiali</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      secret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - id: keycloak.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      redirectURIs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - https://keycloak.${CLUSTER_FQDN}/auth/realms/myrealm/broker/dex/endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: Keycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      secret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - id: oauth2-proxy.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      redirectURIs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - https://oauth2-proxy.${CLUSTER_FQDN}/oauth2/callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: OAuth2 Proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      secret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - id: vault.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      redirectURIs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - https://vault.${CLUSTER_FQDN}/ui/vault/auth/oidc/oidc/callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - http://localhost:8250/oidc/callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: Vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      secret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enablePasswordDB: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="oauth2-proxy">oauth2-proxy<a class="hash-link" aria-label="Direct link to oauth2-proxy" title="Direct link to oauth2-proxy" href="/docosaurus-test/blog#oauth2-proxy">​</a></h2>
<p>Install <a href="https://github.com/oauth2-proxy/oauth2-proxy" target="_blank" rel="noopener noreferrer">oauth2-proxy</a> to secure
the endpoints like (<code>prometheus.</code>, <code>alertmanager.</code>).</p>
<p>Install <code>oauth2-proxy</code>
<a href="https://artifacthub.io/packages/helm/oauth2-proxy/oauth2-proxy" target="_blank" rel="noopener noreferrer">helm chart</a>
and modify the
<a href="https://github.com/oauth2-proxy/manifests/blob/main/helm/oauth2-proxy/values.yaml" target="_blank" rel="noopener noreferrer">default values</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install --version 4.2.0 --namespace oauth2-proxy --create-namespace --values - oauth2-proxy oauth2-proxy/oauth2-proxy &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clientID: oauth2-proxy.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clientSecret: &quot;${MY_PASSWORD}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cookieSecret: &quot;$(openssl rand -base64 32 | head -c 32 | base64)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  configFile: |-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email_domains = [ &quot;*&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    upstreams = [ &quot;file:///dev/null&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    whitelist_domains = &quot;.${CLUSTER_FQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cookie_domains = &quot;.${CLUSTER_FQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    provider = &quot;oidc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    oidc_issuer_url = &quot;https://dex.${CLUSTER_FQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_insecure_skip_verify = &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insecure_oidc_skip_issuer_verification = &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - oauth2-proxy.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tls:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - secretName: ingress-cert-${LETSENCRYPT_ENVIRONMENT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - oauth2-proxy.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  servicemonitor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="gangway">Gangway<a class="hash-link" aria-label="Direct link to Gangway" title="Direct link to Gangway" href="/docosaurus-test/blog#gangway">​</a></h2>
<p>Install gangway:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add --force-update stable https://charts.helm.sh/stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install --version 0.4.5 --namespace gangway --create-namespace --values - gangway stable/gangway &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># https://github.com/helm/charts/blob/master/stable/gangway/values.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trustedCACert: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$(curl -s &quot;${LETSENCRYPT_CERTIFICATE}&quot; | sed &quot;s/^/  /&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gangway:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterName: ${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  authorizeURL: https://dex.${CLUSTER_FQDN}/auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tokenURL: https://dex.${CLUSTER_FQDN}/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  audience: https://dex.${CLUSTER_FQDN}/userinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  redirectURL: https://gangway.${CLUSTER_FQDN}/callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clientID: gangway.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clientSecret: ${MY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiServerURL: https://kube-oidc-proxy.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx.ingress.kubernetes.io/auth-url: https://oauth2-proxy.${CLUSTER_FQDN}/oauth2/auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx.ingress.kubernetes.io/auth-signin: https://oauth2-proxy.${CLUSTER_FQDN}/oauth2/start?rd=\$scheme://\$host\$request_uri</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - gangway.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tls:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - secretName: ingress-cert-${LETSENCRYPT_ENVIRONMENT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - gangway.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kube-oidc-proxy">kube-oidc-proxy<a class="hash-link" aria-label="Direct link to kube-oidc-proxy" title="Direct link to kube-oidc-proxy" href="/docosaurus-test/blog#kube-oidc-proxy">​</a></h2>
<p>The <code>kube-oidc-proxy</code> accepting connections only via HTTPS. It&#x27;s necessary to
configure ingress to communicate with the backend over HTTPS.</p>
<p>Install kube-oidc-proxy:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test -d &quot;tmp/${CLUSTER_FQDN}/kube-oidc-proxy&quot; || git clone --quiet https://github.com/jetstack/kube-oidc-proxy.git &quot;tmp/${CLUSTER_FQDN}/kube-oidc-proxy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git -C &quot;tmp/${CLUSTER_FQDN}/kube-oidc-proxy&quot; checkout --quiet v0.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install --namespace kube-oidc-proxy --create-namespace --values - kube-oidc-proxy &quot;tmp/${CLUSTER_FQDN}/kube-oidc-proxy/deploy/charts/kube-oidc-proxy&quot; &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># https://github.com/jetstack/kube-oidc-proxy/blob/master/deploy/charts/kube-oidc-proxy/values.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oidc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clientId: gangway.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  issuerUrl: https://dex.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usernameClaim: email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  caPEM: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$(curl -s &quot;${LETSENCRYPT_CERTIFICATE}&quot; | sed &quot;s/^/    /&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx.ingress.kubernetes.io/backend-protocol: HTTPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - host: kube-oidc-proxy.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tls:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - secretName: ingress-cert-${LETSENCRYPT_ENVIRONMENT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - kube-oidc-proxy.${CLUSTER_FQDN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you get the credentials form the <a href="https://gangway.kube1.k8s.mylabs.dev" target="_blank" rel="noopener noreferrer">https://gangway.kube1.k8s.mylabs.dev</a>
you will have the access to the cluster, but no rights there.</p>
<p>Add access rights to the user:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f - &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kube-prometheus-stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: secret-reader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- apiGroups: [&quot;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources: [&quot;secrets&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: RoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: read-secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kube-prometheus-stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- kind: User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: ${MY_EMAIL}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: secret-reader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: pods-reader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- apiGroups: [&quot;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources: [&quot;pods&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: read-pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- kind: User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: ${MY_EMAIL}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: pods-reader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The user should be able to read the secrets in <code>kube-prometheus-stack</code>
namespace:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe secrets --insecure-skip-tls-verify -n kube-prometheus-stack &quot;ingress-cert-${LETSENCRYPT_ENVIRONMENT}&quot; # DevSkim: ignore DS126188</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Name:         ingress-cert-staging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:    kube-prometheus-stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:       kubed.appscode.com/origin.cluster=kube1.k8s.mylabs.dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              kubed.appscode.com/origin.name=ingress-cert-staging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              kubed.appscode.com/origin.namespace=cert-manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:  cert-manager.io/alt-names: *.kube1.k8s.mylabs.dev,kube1.k8s.mylabs.dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cert-manager.io/certificate-name: ingress-cert-staging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cert-manager.io/common-name: *.kube1.k8s.mylabs.dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cert-manager.io/ip-sans:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cert-manager.io/issuer-group:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cert-manager.io/issuer-kind: ClusterIssuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cert-manager.io/issuer-name: letsencrypt-staging-dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cert-manager.io/uri-sans:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              kubed.appscode.com/origin:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {&quot;namespace&quot;:&quot;cert-manager&quot;,&quot;name&quot;:&quot;ingress-cert-staging&quot;,&quot;uid&quot;:&quot;f1ed062c-23d9-4cf7-ad51-cfafd8a3b788&quot;,&quot;resourceVersion&quot;:&quot;5296&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type:  kubernetes.io/tls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">====</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tls.crt:  3586 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tls.key:  1679 bytes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>But it&#x27;s not allowed to delete the secrets for the user:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete secrets --insecure-skip-tls-verify -n kube-prometheus-stack &quot;ingress-cert-${LETSENCRYPT_ENVIRONMENT}&quot;   # DevSkim: ignore DS126188</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Error from server (Forbidden): secrets &quot;ingress-cert-staging&quot; is forbidden: User &quot;petr.ruzicka@gmail.com&quot; cannot delete resource &quot;secrets&quot; in API group &quot;&quot; in the namespace &quot;kube-prometheus-stack&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The user can not read secrets outside the <code>kube-prometheus-stack</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get secrets --insecure-skip-tls-verify -n kube-system                                                          # DevSkim: ignore DS126188</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Error from server (Forbidden): secrets is forbidden: User &quot;petr.ruzicka@gmail.com&quot; cannot list resource &quot;secrets&quot; in API group &quot;&quot; in the namespace &quot;kube-system&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see the pods &quot;everywhere&quot;:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --insecure-skip-tls-verify -n kube-system                                                             # DevSkim: ignore DS126188</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                         READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws-for-fluent-bit-5hxlt                                     1/1     Running   0          32m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws-for-fluent-bit-dmvzq                                     1/1     Running   0          32m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws-node-ggfft                                               1/1     Running   0          32m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws-node-lhlvf                                               1/1     Running   0          32m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster-autoscaler-aws-cluster-autoscaler-7f878bccc8-s279k   1/1     Running   0          25m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">coredns-59b69b4849-6v487                                     1/1     Running   0          46m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">coredns-59b69b4849-tw2dg                                     1/1     Running   0          46m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ebs-csi-controller-86785d75db-7brbr                          5/5     Running   0          31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ebs-csi-controller-86785d75db-gn4ll                          5/5     Running   0          31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ebs-csi-node-6h9zv                                           3/3     Running   0          31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ebs-csi-node-r5rj7                                           3/3     Running   0          31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-proxy-m6dm8                                             1/1     Running   0          32m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-proxy-pdmv9                                             1/1     Running   0          32m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>But you can not delete them:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pods --insecure-skip-tls-verify -n kube-oidc-proxy --all                                                # DevSkim: ignore DS126188</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Error from server (Forbidden): pods &quot;kube-oidc-proxy-74bf5679fd-jhdmr&quot; is forbidden: User &quot;petr.ruzicka@gmail.com&quot; cannot delete resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;kube-oidc-proxy&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/eks">EKS</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/image">Image</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/pipeline-templates">Pipeline Templates</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/docosaurus-test/blog/long-blog-post">Long Blog Post</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2019-05-29T00:00:00.000Z">May 29, 2019</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/endiliey" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/endiliey.png" alt="Endilie Yacop Sucipto"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/endiliey" target="_blank" rel="noopener noreferrer"><span>Endilie Yacop Sucipto</span></a></div><small class="avatar__subtitle">Maintainer of Docusaurus</small></div></div></div></div></header><div class="markdown"><p>This is the summary of a very long blog post,</p>
<p>Use a <code>&lt;!--</code> <code>truncate</code> <code>--&gt;</code> comment to limit blog post size in the list view.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/hello">hello</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/docusaurus">docusaurus</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Long Blog Post" href="/docosaurus-test/blog/long-blog-post"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/docosaurus-test/blog/first-blog-post">First Blog Post</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2019-05-28T00:00:00.000Z">May 28, 2019</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/wgao19" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/wgao19.png" alt="Gao Wei"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/wgao19" target="_blank" rel="noopener noreferrer"><span>Gao Wei</span></a></div><small class="avatar__subtitle">Docusaurus Core Team</small></div></div></div></div></header><div class="markdown"><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/hola">hola</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/docusaurus">docusaurus</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docosaurus-test/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docosaurus-test/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© Petr Ruzicka 2024 | Documentation Distributed under <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></div></footer></div>
</body>
</html>