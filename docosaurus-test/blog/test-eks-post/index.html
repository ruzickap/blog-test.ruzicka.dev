<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Test EKS Post | Petr&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog-test.ruzicka.dev/docosaurus-test/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog-test.ruzicka.dev/docosaurus-test/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Test EKS Post | Petr&#x27;s Blog"><meta data-rh="true" name="description" content="![Amazon EKS](https://raw.githubusercontent.com/cncf/landscape/7f5b02ecba914a32912e77fc78e1c54d1c2f98ec/hosted_logos/amazon-eks.svg?sanitize=true"><meta data-rh="true" property="og:description" content="![Amazon EKS](https://raw.githubusercontent.com/cncf/landscape/7f5b02ecba914a32912e77fc78e1c54d1c2f98ec/hosted_logos/amazon-eks.svg?sanitize=true"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-12-10T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://petr.ruzicka.dev"><meta data-rh="true" property="article:tag" content="EKS,Pipeline Templates"><link data-rh="true" rel="icon" href="https://raw.githubusercontent.com/cncf/artwork/40e2e8948509b40e4bad479446aaec18d6273bf2/projects/kubernetes/icon/color/kubernetes-icon-color.svg"><link data-rh="true" rel="canonical" href="https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post"><link data-rh="true" rel="alternate" href="https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post","mainEntityOfPage":"https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post","url":"https://blog-test.ruzicka.dev/docosaurus-test/blog/test-eks-post","headline":"Test EKS Post","name":"Test EKS Post","description":"![Amazon EKS](https://raw.githubusercontent.com/cncf/landscape/7f5b02ecba914a32912e77fc78e1c54d1c2f98ec/hosted_logos/amazon-eks.svg?sanitize=true","datePublished":"2020-12-10T00:00:00.000Z","author":{"@type":"Person","name":"Petr Ruzicka","description":"Blog owner","url":"https://petr.ruzicka.dev","image":"https://github.com/ruzickap.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://blog-test.ruzicka.dev/docosaurus-test/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/docosaurus-test/blog/rss.xml" title="Petr&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docosaurus-test/blog/atom.xml" title="Petr&#39;s Blog Atom Feed"><link rel="stylesheet" href="/docosaurus-test/assets/css/styles.2d3f038e.css">
<script src="/docosaurus-test/assets/js/runtime~main.2e84ab3f.js" defer="defer"></script>
<script src="/docosaurus-test/assets/js/main.7c492edf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docosaurus-test/"><div class="navbar__logo"><img src="https://raw.githubusercontent.com/cncf/artwork/40e2e8948509b40e4bad479446aaec18d6273bf2/projects/networkservicemesh/icon/color/networkservicemesh-icon-color-reversed.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://raw.githubusercontent.com/cncf/artwork/40e2e8948509b40e4bad479446aaec18d6273bf2/projects/networkservicemesh/icon/color/networkservicemesh-icon-color-reversed.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Petr&#x27;s Blog</b></a><a class="navbar__item navbar__link" href="/docosaurus-test/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docosaurus-test/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docosaurus-test/blog/first-post">First_post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docosaurus-test/blog/welcome">Welcome</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docosaurus-test/blog/mdx-blog-post">MDX Blog Post</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/docosaurus-test/blog/test-eks-post">Test EKS Post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docosaurus-test/blog/image-test-eks-post">Image Test EKS Post</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Test EKS Post</h1><div class="container_mt6G margin-vert--md"><time datetime="2020-12-10T00:00:00.000Z">December 10, 2020</time> Â· <!-- -->22 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://petr.ruzicka.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ruzickap.png" alt="Petr Ruzicka"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://petr.ruzicka.dev" target="_blank" rel="noopener noreferrer"><span>Petr Ruzicka</span></a></div><small class="avatar__subtitle">Blog owner</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><img decoding="async" loading="lazy" src="https://raw.githubusercontent.com/cncf/landscape/7f5b02ecba914a32912e77fc78e1c54d1c2f98ec/hosted_logos/amazon-eks.svg?sanitize=true" alt="Amazon EKS" title="Amazon EKS" class="img_ev3q"></p>
<p>Before starting with the main content, it&#x27;s necessary to provision
the <a href="https://aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer">Amazon EKS</a> in AWS.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements" href="/docosaurus-test/blog/test-eks-post#requirements">â</a></h2>
<p>If you would like to follow this documents and it&#x27;s task you will need to set up
few environment variables.</p>
<p>The <code>LETSENCRYPT_ENVIRONMENT</code> variable should be one of:</p>
<ul>
<li><code>staging</code> - Letâs Encrypt will create testing certificate (not valid)</li>
<li><code>production</code> - Letâs Encrypt will create valid certificate (use with care)</li>
</ul>
<p><code>BASE_DOMAIN</code> contains DNS records for all your Kubernetes clusters. The cluster
names will look like <code>CLUSTER_NAME</code>.<code>BASE_DOMAIN</code> (<code>kube1.k8s.mylabs.dev</code>).</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Hostname / FQDN definitions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_DOMAIN=${BASE_DOMAIN:-k8s.mylabs.dev}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export CLUSTER_NAME=${CLUSTER_NAME:-kube1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export CLUSTER_FQDN=&quot;${CLUSTER_NAME}.${BASE_DOMAIN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export KUBECONFIG=${PWD}/kubeconfig-${CLUSTER_NAME}.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># * &quot;production&quot; - valid certificates signed by Lets Encrypt &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># * &quot;staging&quot; - not trusted certs signed by Lets Encrypt &quot;Fake LE Intermediate X1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export LETSENCRYPT_ENVIRONMENT=&quot;staging&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export LETSENCRYPT_CERTIFICATE=&quot;https://letsencrypt.org/certs/staging/letsencrypt-stg-root-x1.pem&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># export LETSENCRYPT_ENVIRONMENT=&quot;production&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># export LETSENCRYPT_CERTIFICATE=&quot;https://letsencrypt.org/certs/lets-encrypt-r3.pem&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_EMAIL=&quot;petr.ruzicka@gmail.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GitHub Organization + Team where are the users who will have the admin access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># to K8s resources (Grafana). Only users in GitHub organization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (MY_GITHUB_ORG_NAME) will be able to access the apps via ingress.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_NAME=&quot;ruzickap-org&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_USERNAME=&quot;ruzickap&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># AWS Region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AWS_DEFAULT_REGION=&quot;eu-west-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SLACK_CHANNEL=&quot;mylabs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tags used to tag the AWS resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export TAGS=&quot;Owner=${MY_EMAIL} Environment=Dev Group=Cloud_Native Squad=Cloud_Container_Platform compliance:na:defender=bottlerocket&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e &quot;${MY_EMAIL} | ${LETSENCRYPT_ENVIRONMENT} | ${CLUSTER_NAME} | ${BASE_DOMAIN} | ${CLUSTER_FQDN}\n${TAGS}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Prepare GitHub OAuth &quot;access&quot; credentials ans AWS &quot;access&quot; variables.</p>
<p>You will need to configure AWS CLI: <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html" target="_blank" rel="noopener noreferrer">Configuring the AWS CLI</a></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Common password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_PASSWORD=&quot;xxxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># AWS Credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AWS_ACCESS_KEY_ID=&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AWS_SECRET_ACCESS_KEY=&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AWS_CONSOLE_ADMIN_ROLE_ARN=&quot;arn:aws:iam::7xxxxxxxxxx7:role/xxxxxxxxxxxxxN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GitHub Organization OAuth Apps credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID=&quot;3xxxxxxxxxxxxxxxxxx3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET=&quot;7xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID=&quot;4xxxxxxxxxxxxxxxxxx4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET=&quot;7xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Sysdig credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SYSDIG_AGENT_ACCESSKEY=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Aqua credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AQUA_REGISTRY_USERNAME=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AQUA_REGISTRY_PASSWORD=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AQUA_ENFORCER_TOKEN=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Splunk credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SPLUNK_HOST=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SPLUNK_TOKEN=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SPLUNK_INDEX_NAME=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Slack incoming webhook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SLACK_INCOMING_WEBHOOK_URL=&quot;https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SLACK_BOT_API_TOKEN=&quot;xxxx-xxxxxxxxxxxxx-xxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Okta configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export OKTA_ISSUER=&quot;https://exxxxxxx-xxxxx-xx.okta.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export OKTA_CLIENT_ID=&quot;0xxxxxxxxxxxxxxxxxx7&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export OKTA_CLIENT_SECRET=&quot;1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxH&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Verify if all the necessary variables were set:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">case &quot;${CLUSTER_NAME}&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kube1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID=${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID:-${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID_KUBE1}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET=${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET:-${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET_KUBE1}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID=${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID:-${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID_KUBE1}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET=${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET:-${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET_KUBE1}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kube2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID=${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID:-${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_ID_KUBE2}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET=${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET:-${MY_GITHUB_ORG_OAUTH_DEX_CLIENT_SECRET_KUBE2}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID=${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID:-${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_ID_KUBE2}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET=${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET:-${MY_GITHUB_ORG_OAUTH_KEYCLOAK_CLIENT_SECRET_KUBE2}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Unsupported cluster name: ${CLUSTER_NAME} !&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">esac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${AWS_ACCESS_KEY_ID?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${AWS_SECRET_ACCESS_KEY?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${AWS_CONSOLE_ADMIN_ROLE_ARN?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${GITHUB_TOKEN?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${SLACK_INCOMING_WEBHOOK_URL?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${SLACK_BOT_API_TOKEN?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${MY_PASSWORD?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${OKTA_ISSUER?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${OKTA_CLIENT_ID?}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &quot;${OKTA_CLIENT_SECRET?}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-the-local-working-environment">Prepare the local working environment<a class="hash-link" aria-label="Direct link to Prepare the local working environment" title="Direct link to Prepare the local working environment" href="/docosaurus-test/blog/test-eks-post#prepare-the-local-working-environment">â</a></h2>
<p>::: tip
You can skip these steps if you have all the required software already
installed.
:::</p>
<p>Install necessary software:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if command -v apt-get &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apt update -qq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DEBIAN_FRONTEND=noninteractive apt-get install -y -qq apache2-utils ansible dnsutils git gnupg2 jq sudo unzip &gt; /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer">AWS CLI</a>  binary:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v aws &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -sL &quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot; -o &quot;/tmp/awscliv2.zip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unzip -q -o /tmp/awscliv2.zip -d /tmp/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo /tmp/aws/install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/kubernetes/kubectl" target="_blank" rel="noopener noreferrer">kubectl</a> binary:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v kubectl &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # https://github.com/kubernetes/kubectl/releases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/kubectl &quot;https://storage.googleapis.com/kubernetes-release/release/v1.21.1/bin/$(uname | sed &quot;s/./\L&amp;/g&quot;)/amd64/kubectl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v helm &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # https://github.com/helm/helm/releases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s https://raw.githubusercontent.com/helm/helm/master/scripts/get | bash -s -- --version v3.6.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://eksctl.io/" target="_blank" rel="noopener noreferrer">eksctl</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v eksctl &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # https://github.com/weaveworks/eksctl/releases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s -L &quot;https://github.com/weaveworks/eksctl/releases/download/0.60.0/eksctl_$(uname)_amd64.tar.gz&quot; | sudo tar xz -C /usr/local/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/kubernetes-sigs/aws-iam-authenticator" target="_blank" rel="noopener noreferrer">AWS IAM Authenticator for Kubernetes</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v aws-iam-authenticator &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # https://docs.aws.amazon.com/eks/latest/userguide/install-aws-iam-authenticator.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/aws-iam-authenticator &quot;https://amazon-eks.s3.us-west-2.amazonaws.com/1.19.6/2021-01-05/bin/$(uname | sed &quot;s/./\L&amp;/g&quot;)/amd64/aws-iam-authenticator&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/aws-iam-authenticator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://www.vaultproject.io/downloads" target="_blank" rel="noopener noreferrer">vault</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v vault &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s -L &quot;https://releases.hashicorp.com/vault/1.7.2/vault_1.7.2_$(uname | sed &quot;s/./\L&amp;/g&quot;)_amd64.zip&quot; -o /tmp/vault.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo unzip -q /tmp/vault.zip -d /usr/local/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rm /tmp/vault.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/vmware-tanzu/velero/releases" target="_blank" rel="noopener noreferrer">velero</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v velero &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s -L &quot;https://github.com/vmware-tanzu/velero/releases/download/v1.6.0/velero-v1.6.0-$(uname | sed &quot;s/./\L&amp;/g&quot;)-amd64.tar.gz&quot; -o /tmp/velero.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo tar xzf /tmp/velero.tar.gz -C /usr/local/bin/ --strip-components 1 &quot;velero-v1.6.0-$(uname | sed &quot;s/./\L&amp;/g&quot;)-amd64/velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://toolkit.fluxcd.io/" target="_blank" rel="noopener noreferrer">flux</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v flux &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s https://fluxcd.io/install.sh | sudo bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <code>calicoctl</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v calicoctl &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/calicoctl https://github.com/projectcalico/calicoctl/releases/download/v3.20.0/calicoctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/calicoctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/mozilla/sops" target="_blank" rel="noopener noreferrer">SOPS: Secrets OPerationS</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v sops &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/sops &quot;https://github.com/mozilla/sops/releases/download/v3.7.1/sops-v3.7.1.$(uname | sed &quot;s/./\L&amp;/g&quot;)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/sops</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://kustomize.io/" target="_blank" rel="noopener noreferrer">kustomize</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v kustomize &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  curl -s &quot;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&quot; | sudo bash -s 4.1.2 /usr/local/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install <a href="https://github.com/rakyll/hey" target="_blank" rel="noopener noreferrer">hey</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! command -v hey &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo curl -s -Lo /usr/local/bin/hey &quot;https://hey-release.s3.us-east-2.amazonaws.com/hey_$(uname | sed &quot;s/./\L&amp;/g&quot;)_amd64&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chmod a+x /usr/local/bin/hey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-aws-route-53-domain-delegation">Configure AWS Route 53 Domain delegation<a class="hash-link" aria-label="Direct link to Configure AWS Route 53 Domain delegation" title="Direct link to Configure AWS Route 53 Domain delegation" href="/docosaurus-test/blog/test-eks-post#configure-aws-route-53-domain-delegation">â</a></h2>
<p>Create DNS zone (<code>BASE_DOMAIN</code>):</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws route53 create-hosted-zone --output json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name &quot;${BASE_DOMAIN}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --caller-reference &quot;$(date)&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --hosted-zone-config=&quot;{\&quot;Comment\&quot;: \&quot;Created by ${MY_EMAIL}\&quot;, \&quot;PrivateZone\&quot;: false}&quot; | jq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use your domain registrar to change the nameservers for your zone (for example
&quot;mylabs.dev&quot;) to use the Amazon Route 53 nameservers. Here is the way how you
can find out the the Route 53 nameservers:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NEW_ZONE_ID=$(aws route53 list-hosted-zones --query &quot;HostedZones[?Name==\`${BASE_DOMAIN}.\`].Id&quot; --output text)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NEW_ZONE_NS=$(aws route53 get-hosted-zone --output json --id &quot;${NEW_ZONE_ID}&quot; --query &quot;DelegationSet.NameServers&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NEW_ZONE_NS1=$(echo &quot;${NEW_ZONE_NS}&quot; | jq -r &quot;.[0]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NEW_ZONE_NS2=$(echo &quot;${NEW_ZONE_NS}&quot; | jq -r &quot;.[1]&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create the NS record in <code>k8s.mylabs.dev</code> (<code>BASE_DOMAIN</code>) for proper zone
delegation. This step depends on your domain registrar - I&#x27;m using CloudFlare
and using Ansible to automate it:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ansible -m cloudflare_dns -c local -i &quot;localhost,&quot; localhost -a &quot;zone=mylabs.dev record=${BASE_DOMAIN} type=NS value=${NEW_ZONE_NS1} solo=true proxied=no account_email=${CLOUDFLARE_EMAIL} account_api_token=${CLOUDFLARE_API_KEY}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ansible -m cloudflare_dns -c local -i &quot;localhost,&quot; localhost -a &quot;zone=mylabs.dev record=${BASE_DOMAIN} type=NS value=${NEW_ZONE_NS2} solo=false proxied=no account_email=${CLOUDFLARE_EMAIL} account_api_token=${CLOUDFLARE_API_KEY}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost | CHANGED =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ansible_facts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;changed&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;result&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;record&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;content&quot;: &quot;ns-885.awsdns-46.net&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;created_on&quot;: &quot;2020-11-13T06:25:32.18642Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;id&quot;: &quot;dxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;locked&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;meta&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;auto_added&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;managed_by_apps&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;managed_by_argo_tunnel&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;source&quot;: &quot;primary&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;modified_on&quot;: &quot;2020-11-13T06:25:32.18642Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;name&quot;: &quot;k8s.mylabs.dev&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;proxiable&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;proxied&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ttl&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;type&quot;: &quot;NS&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;zone_id&quot;: &quot;2xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxe&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;zone_name&quot;: &quot;mylabs.dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localhost | CHANGED =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ansible_facts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;changed&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;result&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;record&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;content&quot;: &quot;ns-1692.awsdns-19.co.uk&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;created_on&quot;: &quot;2020-11-13T06:25:37.605605Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;id&quot;: &quot;9xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;locked&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;meta&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;auto_added&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;managed_by_apps&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;managed_by_argo_tunnel&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;source&quot;: &quot;primary&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;modified_on&quot;: &quot;2020-11-13T06:25:37.605605Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;name&quot;: &quot;k8s.mylabs.dev&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;proxiable&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;proxied&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ttl&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;type&quot;: &quot;NS&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;zone_id&quot;: &quot;2xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxe&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;zone_name&quot;: &quot;mylabs.dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-new-domain-to-route-53-policies-s3-ebs">Add new domain to Route 53, Policies, S3, EBS<a class="hash-link" aria-label="Direct link to Add new domain to Route 53, Policies, S3, EBS" title="Direct link to Add new domain to Route 53, Policies, S3, EBS" href="/docosaurus-test/blog/test-eks-post#add-new-domain-to-route-53-policies-s3-ebs">â</a></h2>
<p>Details with examples are described on these links:</p>
<ul>
<li><a href="https://aws.amazon.com/blogs/opensource/introducing-fine-grained-iam-roles-service-accounts/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/blogs/opensource/introducing-fine-grained-iam-roles-service-accounts/</a></li>
<li><a href="https://cert-manager.io/docs/configuration/acme/dns01/route53/" target="_blank" rel="noopener noreferrer">https://cert-manager.io/docs/configuration/acme/dns01/route53/</a></li>
<li><a href="https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md</a></li>
</ul>
<p>Create CloudFormation template containing policies for Route53, S3 access
(Harbor, Velero) and Domain. Put new domain <code>CLUSTER_FQDN</code> to the Route 53 and
configure the DNS delegation from the <code>BASE_DOMAIN</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -vp &quot;tmp/${CLUSTER_FQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; &quot;tmp/${CLUSTER_FQDN}/aws-route53-iam-s3-kms-asm.yml&quot; &lt;&lt; \EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description: &quot;Template to generate the necessary IAM Policies for access to Route53 and S3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ClusterFQDN:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: &quot;Cluster domain where all necessary app subdomains will live (subdomain of BaseDomain). Ex: kube1.k8s.mylabs.dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ClusterName:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: &quot;Cluster Name Ex: kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BaseDomain:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: &quot;Base domain where cluster domains + their subdomains will live. Ex: k8s.mylabs.dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # This AWS control checks whether the status of the AWS Systems Manager association compliance is COMPLIANT or NON_COMPLIANT after the association is executed on an instance.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ConfigRule:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: &quot;AWS::Config::ConfigRule&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ConfigRuleName: !Sub &quot;${ClusterName}-ec2-managedinstance-association-compliance-status-check&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Scope:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ComplianceResourceTypes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;AWS::SSM::AssociationCompliance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: &quot;A Config rule that checks whether the compliance status of the Amazon EC2 Systems Manager association compliance is COMPLIANT or NON_COMPLIANT after the association execution on the instance. The rule is compliant if the field status is COMPLIANT.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Source:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Owner: &quot;AWS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SourceIdentifier: &quot;EC2_MANAGEDINSTANCE_ASSOCIATION_COMPLIANCE_STATUS_CHECK&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CloudWatchPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::ManagedPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ManagedPolicyName: !Sub &quot;${ClusterFQDN}-CloudWatch&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;Policy required by Fargate to log to CloudWatch for ${ClusterFQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - logs:CreateLogStream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - logs:CreateLogGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - logs:DescribeLogStreams</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - logs:PutLogEvents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HostedZone:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Route53::HostedZone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name: !Ref ClusterFQDN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KMSAlias:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::KMS::Alias</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AliasName: !Sub &quot;alias/eks-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TargetKeyId: !Ref KMSKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KMSKey:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::KMS::Key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;KMS key for secrets related to ${ClusterFQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      EnableKeyRotation: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PendingWindowInDays: 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      KeyPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Id: !Sub &quot;eks-key-policy-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: Enable IAM User Permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:root&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action: kms:*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: Allow use of the key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:role/aws-service-role/autoscaling.amazonaws.com/AWSServiceRoleForAutoScaling&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Encrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Decrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:ReEncrypt*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:GenerateDataKey*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:DescribeKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: Allow attachment of persistent resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:role/aws-service-role/autoscaling.amazonaws.com/AWSServiceRoleForAutoScaling&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:CreateGrant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Condition:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Bool:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              kms:GrantIsForAWSResource: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EKSViewNodesAndWorkloadsPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::ManagedPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ManagedPolicyName: !Sub &quot;${ClusterFQDN}-EKSViewNodesAndWorkloads&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;Policy used to view workloads running in an EKS cluster created using CAPA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:DescribeNodegroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:ListNodegroups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:DescribeCluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:ListClusters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:AccessKubernetesApi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ssm:GetParameter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:ListUpdates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - eks:ListFargateProfiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RecordSet:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Route53::RecordSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HostedZoneName: !Sub &quot;${BaseDomain}.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name: !Ref ClusterFQDN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Type: NS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TTL: 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ResourceRecords: !GetAtt HostedZone.NameServers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  S3Policy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::ManagedPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ManagedPolicyName: !Sub &quot;${ClusterFQDN}-AmazonS3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;Policy required by Harbor and Velero to write to S3 bucket ${ClusterFQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:ListBucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:GetBucketLocation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:ListBucketMultipartUploads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: !GetAtt S3Bucket.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:PutObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:GetObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:DeleteObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:ListMultipartUploadParts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - s3:AbortMultipartUpload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: !Sub &quot;arn:aws:s3:::${ClusterFQDN}/*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  S3Bucket:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::S3::Bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AccessControl: Private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      BucketName: !Sub &quot;${ClusterFQDN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      BucketEncryption:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ServerSideEncryptionConfiguration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ServerSideEncryptionByDefault:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              SSEAlgorithm: AES256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecretsManagerMySecret:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::SecretsManager::Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name: !Sub &quot;${ClusterFQDN}-MySecret&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: My Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      GenerateSecretString:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SecretStringTemplate: &quot;{\&quot;username\&quot;: \&quot;Administrator\&quot;}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GenerateStringKey: password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PasswordLength: 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      KmsKeyId: !Ref KMSKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecretsManagerMySecret2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::SecretsManager::Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name: !Sub &quot;${ClusterFQDN}-MySecret2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: My Secret2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      GenerateSecretString:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SecretStringTemplate: &quot;{\&quot;username\&quot;: \&quot;Administrator2\&quot;}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GenerateStringKey: password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PasswordLength: 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      KmsKeyId: !Ref KMSKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UserMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserName: !Sub &quot;myuser1-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Policies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - PolicyName: !Sub &quot;myuser1-${ClusterName}-policy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - Sid: AllowAssumeOrganizationAccountRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Action: sts:AssumeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Resource: !GetAtt RoleMyUser1.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AccessKeyMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::AccessKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserName: !Ref UserMyUser1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RoleMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;IAM role for the myuser1-${ClusterName} user&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RoleName: !Sub &quot;myuser1-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AssumeRolePolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:root&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action: sts:AssumeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UserMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserName: !Sub &quot;myuser2-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Policies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - PolicyName: !Sub &quot;myuser2-${ClusterName}-policy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Version: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - Sid: AllowAssumeOrganizationAccountRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Action: sts:AssumeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Resource: !GetAtt RoleMyUser2.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AccessKeyMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::AccessKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserName: !Ref UserMyUser2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RoleMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::IAM::Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Description: !Sub &quot;IAM role for the myuser2-${ClusterName} user&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RoleName: !Sub &quot;myuser2-${ClusterName}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AssumeRolePolicyDocument:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Principal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AWS: !Sub &quot;arn:aws:iam::${AWS::AccountId}:root&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action: sts:AssumeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Outputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CloudWatchPolicyArn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the created CloudWatchPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref CloudWatchPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-CloudWatchPolicyArn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KMSKeyArn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the created KMS Key to encrypt EKS related services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt KMSKey.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-KMSKeyArn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KMSKeyId:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ID of the created KMS Key to encrypt EKS related services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref KMSKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-KMSKeyId&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HostedZoneArn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the created Route53 Zone for K8s cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref HostedZone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-HostedZoneArn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  S3PolicyArn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the created AmazonS3 policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref S3Policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-S3PolicyArn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RoleMyUser1Arn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the MyUser1 IAM Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt RoleMyUser1.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-RoleMyUser1Arn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AccessKeyMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The AccessKey for MyUser1 user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref AccessKeyMyUser1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-AccessKeyMyUser1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecretAccessKeyMyUser1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The SecretAccessKey for MyUser1 user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt AccessKeyMyUser1.SecretAccessKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-SecretAccessKeyMyUser1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RoleMyUser2Arn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The ARN of the MyUser2 IAM Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt RoleMyUser2.Arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-RoleMyUser2Arn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AccessKeyMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The AccessKey for MyUser2 user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !Ref AccessKeyMyUser2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-AccessKeyMyUser2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecretAccessKeyMyUser2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: The SecretAccessKey for MyUser2 user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Value: !GetAtt AccessKeyMyUser2.SecretAccessKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Export:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fn::Sub: &quot;${AWS::StackName}-SecretAccessKeyMyUser2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eval aws cloudformation deploy --capabilities CAPABILITY_NAMED_IAM \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --parameter-overrides &quot;ClusterFQDN=${CLUSTER_FQDN} ClusterName=${CLUSTER_NAME} BaseDomain=${BASE_DOMAIN}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --stack-name &quot;${CLUSTER_NAME}-route53-iam-s3-kms-asm&quot; --template-file &quot;tmp/${CLUSTER_FQDN}/aws-route53-iam-s3-kms-asm.yml&quot; --tags &quot;${TAGS}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AWS_CLOUDFORMATION_DETAILS=$(aws cloudformation describe-stacks --stack-name &quot;${CLUSTER_NAME}-route53-iam-s3-kms-asm&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CLOUDWATCH_POLICY_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;CloudWatchPolicyArn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KMS_KEY_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;KMSKeyArn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KMS_KEY_ID=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;KMSKeyId\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S3_POLICY_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;S3PolicyArn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER1_ROLE_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;RoleMyUser1Arn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER1_USER_ACCESSKEYMYUSER=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;AccessKeyMyUser1\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER1_USER_SECRETACCESSKEY=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;SecretAccessKeyMyUser1\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER2_ROLE_ARN=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;RoleMyUser2Arn\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER2_USER_ACCESSKEYMYUSER=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;AccessKeyMyUser2\&quot;) .OutputValue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MYUSER2_USER_SECRETACCESSKEY=$(echo &quot;${AWS_CLOUDFORMATION_DETAILS}&quot; | jq -r &quot;.Stacks[0].Outputs[] | select(.OutputKey==\&quot;SecretAccessKeyMyUser2\&quot;) .OutputValue&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Change TTL=60 of SOA + NS records for new domain
(it can not be done in CloudFormation):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HOSTED_ZONE_ID=$(aws route53 list-hosted-zones --query &quot;HostedZones[?Name==\`${CLUSTER_FQDN}.\`].Id&quot; --output text)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RESOURCE_RECORD_SET_SOA=$(aws route53 --output json list-resource-record-sets --hosted-zone-id &quot;${HOSTED_ZONE_ID}&quot; --query &quot;(ResourceRecordSets[?Type == \`SOA\`])[0]&quot; | sed &quot;s/\&quot;TTL\&quot;:.*/\&quot;TTL\&quot;: 60,/&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RESOURCE_RECORD_SET_NS=$(aws route53 --output json list-resource-record-sets --hosted-zone-id &quot;${HOSTED_ZONE_ID}&quot; --query &quot;(ResourceRecordSets[?Type == \`NS\`])[0]&quot; | sed &quot;s/\&quot;TTL\&quot;:.*/\&quot;TTL\&quot;: 60,/&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt; EOF | aws route53 --output json change-resource-record-sets --hosted-zone-id &quot;${HOSTED_ZONE_ID}&quot; --change-batch=file:///dev/stdin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Comment&quot;: &quot;Update record to reflect new TTL for SOA and NS records&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Changes&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Action&quot;: &quot;UPSERT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ResourceRecordSet&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">${RESOURCE_RECORD_SET_SOA}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Action&quot;: &quot;UPSERT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ResourceRecordSet&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">${RESOURCE_RECORD_SET_NS}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-amazon-eks">Create Amazon EKS<a class="hash-link" aria-label="Direct link to Create Amazon EKS" title="Direct link to Create Amazon EKS" href="/docosaurus-test/blog/test-eks-post#create-amazon-eks">â</a></h2>
<p><img decoding="async" loading="lazy" src="https://raw.githubusercontent.com/aws-samples/eks-workshop/65b766c494a5b4f5420b2912d8373c4957163541/static/images/3-service-animated.gif" alt="EKS" title="EKS" class="img_ev3q"></p>
<p>Create <a href="https://aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer">Amazon EKS</a> in AWS by using <a href="https://eksctl.io/" target="_blank" rel="noopener noreferrer">eksctl</a>.
It&#x27;s a tool from Weaveworks based on official
AWS CloudFormation templates which will be used to launch and configure our
EKS cluster and nodes.</p>
<p><img decoding="async" loading="lazy" src="https://raw.githubusercontent.com/weaveworks/eksctl/c365149fc1a0b8d357139cbd6cda5aee8841c16c/logo/eksctl.png" alt="eksctl" title="eksctl" class="img_ev3q"></p>
<p>Generate SSH key if not exists:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test -f ~/.ssh/id_rsa.pub || (install -m 0700 -d ~/.ssh &amp;&amp; ssh-keygen -b 2048 -t rsa -f ~/.ssh/id_rsa -q -N &quot;&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create the Amazon EKS cluster with Calico using <code>eksctl</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; &quot;tmp/${CLUSTER_FQDN}/eksctl.yaml&quot; &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: eksctl.io/v1alpha5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: ${CLUSTER_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region: ${AWS_DEFAULT_REGION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version: &quot;1.21&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags: &amp;tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$(echo &quot;${TAGS}&quot; | sed &quot;s/ /\\n    /g; s/^/    /g; s/=/: /g&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">availabilityZones:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ${AWS_DEFAULT_REGION}a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ${AWS_DEFAULT_REGION}b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iam:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  withOIDC: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceAccounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: aws-load-balancer-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        awsLoadBalancerController: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: cert-manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: cert-manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        certManager: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: cluster-autoscaler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        autoScaler: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: external-dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: external-dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        externalDNS: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: ebs-csi-controller-sa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ebsCSIController: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: harbor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: harbor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - ${S3_POLICY_ARN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: velero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: velero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - ${S3_POLICY_ARN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: s3-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: s3-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - ${S3_POLICY_ARN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-prometheus-stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - arn:aws:iam::aws:policy/AmazonPrometheusQueryAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - arn:aws:iam::aws:policy/CloudWatchReadOnlyAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: AllowReadingTagsInstancesRegionsFromEC2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ec2:DescribeTags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ec2:DescribeInstances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ec2:DescribeRegions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: AllowReadingResourcesForTags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action: tag:GetResources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: kube-prometheus-stack-prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-prometheus-stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicyARNs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - arn:aws:iam::aws:policy/AmazonPrometheusQueryAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - arn:aws:iam::aws:policy/AmazonPrometheusRemoteWriteAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: efs-csi-controller-sa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wellKnownPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        efsCSIController: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: VaultKMSUnseal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Encrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Decrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:DescribeKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;${KMS_KEY_ARN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: kuard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: kuard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attachPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 2012-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: AllowSecretManagerAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - secretsmanager:GetSecretValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - secretsmanager:DescribeSecret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;arn:aws:secretsmanager:*:*:secret:*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Sid: AllowKMSAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - kms:Decrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;${KMS_KEY_ARN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vpc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nat:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gateway: Disable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">managedNodeGroups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: managed-ng-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    amiFamily: Bottlerocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instanceType: t3.xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instancePrefix: ruzickap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desiredCapacity: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    minSize: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxSize: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeSize: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      role: worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags: *tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iam:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      withAddonPolicies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        autoScaler: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cloudWatch: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ebs: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        efs: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxPodsPerNode: 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeEncrypted: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeKmsKeyID: ${KMS_KEY_ID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fargateProfiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: fp-fgtest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selectors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - namespace: fgtest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags: *tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secretsEncryption:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  keyARN: ${KMS_KEY_ARN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudWatch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterLogging:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enableTypes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - authenticator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ! eksctl get clusters --name=&quot;${CLUSTER_NAME}&quot; &amp;&gt; /dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eksctl create cluster --config-file &quot;tmp/${CLUSTER_FQDN}/eksctl.yaml&quot; --kubeconfig &quot;${KUBECONFIG}&quot; --without-nodegroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubectl delete daemonset -n kube-system aws-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubectl apply -f https://docs.projectcalico.org/archive/v3.20/manifests/calico-vxlan.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eksctl create nodegroup --config-file &quot;tmp/${CLUSTER_FQDN}/eksctl.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  eksctl version 0.75.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  using region eu-west-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  subnets for eu-west-1a - public:192.168.0.0/19 private:192.168.64.0/19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  subnets for eu-west-1b - public:192.168.32.0/19 private:192.168.96.0/19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  using Kubernetes version 1.21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  creating EKS cluster &quot;kube1&quot; in &quot;eu-west-1&quot; region with Fargate profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  will create a CloudFormation stack for cluster itself and 0 nodegroup stack(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  will create a CloudFormation stack for cluster itself and 0 managed nodegroup stack(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  if you encounter any issues, check CloudFormation console or try &#x27;eksctl utils describe-stacks --region=eu-west-1 --cluster=kube1&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  Kubernetes API endpoint access will use default of {publicAccess=true, privateAccess=false} for cluster &quot;kube1&quot; in &quot;eu-west-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 sequential tasks: { create cluster control plane &quot;kube1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    7 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wait for control plane to become ready,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tag cluster,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        update CloudWatch logging configuration,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        create fargate profiles,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        associate IAM OIDC provider,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        14 parallel sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/aws-load-balancer-controller&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/aws-load-balancer-controller&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;cert-manager/cert-manager&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;cert-manager/cert-manager&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/cluster-autoscaler&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/cluster-autoscaler&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;external-dns/external-dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;external-dns/external-dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/ebs-csi-controller-sa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/ebs-csi-controller-sa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;harbor/harbor&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;harbor/harbor&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;velero/velero&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;velero/velero&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;s3-test/s3-test&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;s3-test/s3-test&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-prometheus-stack/grafana&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-prometheus-stack/grafana&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-prometheus-stack/kube-prometheus-stack-prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-prometheus-stack/kube-prometheus-stack-prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/efs-csi-controller-sa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/efs-csi-controller-sa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;vault/vault&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;vault/vault&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kuard/kuard&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kuard/kuard&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2 sequential sub-tasks: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create IAM role for serviceaccount &quot;kube-system/aws-node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create serviceaccount &quot;kube-system/aws-node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        restart daemonset &quot;kube-system/aws-node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  building cluster stack &quot;eksctl-kube1-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:52:50 [â¹]  deploying stack &quot;eksctl-kube1-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 17:53:21 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:05:55 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:07:59 [â]  tagged EKS cluster (Owner=petr.ruzicka@gmail.com, Squad=Cloud_Container_Platform, compliance:na:defender=bottlerocket, Environment=Dev, Group=Cloud_Native)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:08:00 [â¹]  waiting for requested &quot;LoggingUpdate&quot; in cluster &quot;kube1&quot; to succeed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:08:53 [â¹]  waiting for requested &quot;LoggingUpdate&quot; in cluster &quot;kube1&quot; to succeed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:08:54 [â]  configured CloudWatch logging for cluster &quot;kube1&quot; in &quot;eu-west-1&quot; (enabled types: authenticator &amp; disabled types: api, audit, controllerManager, scheduler)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:08:54 [â¹]  creating Fargate profile &quot;fp-fgtest&quot; on EKS cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:13:12 [â¹]  created Fargate profile &quot;fp-fgtest&quot; on EKS cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:44 [â¹]  building iamserviceaccount stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  deploying stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:17:45 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:00 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:00 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:01 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:02 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:02 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:02 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:02 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:03 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:03 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:03 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:04 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:04 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:04 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:05 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:17 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-harbor-harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [â¹]  created namespace &quot;harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [â¹]  created serviceaccount &quot;harbor/harbor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-s3-test-s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [â¹]  created namespace &quot;s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:18 [â¹]  created serviceaccount &quot;s3-test/s3-test&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:19 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-velero-velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:19 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:19 [â¹]  created namespace &quot;velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:19 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:20 [â¹]  created serviceaccount &quot;velero/velero&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:20 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:20 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [â¹]  created namespace &quot;kube-prometheus-stack&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [â¹]  created serviceaccount &quot;kube-prometheus-stack/kube-prometheus-stack-prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:21 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [â¹]  serviceaccount &quot;kube-system/aws-node&quot; already exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:24 [â¹]  updated serviceaccount &quot;kube-system/aws-node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:35 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:36 [â¹]  created serviceaccount &quot;kube-system/cluster-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:37 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-prometheus-stack-grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kuard-kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [â¹]  created serviceaccount &quot;kube-prometheus-stack/grafana&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [  â¹]  created namespace &quot;kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [â¹]  created serviceaccount &quot;kuard/kuard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-vault-vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-cert-manager-cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:38 [â¹]  created namespace &quot;vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [â¹]  created serviceaccount &quot;vault/vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [â¹]  created namespace &quot;cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [â¹]  created serviceaccount &quot;cert-manager/cert-manager&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [â¹]  created serviceaccount &quot;kube-system/aws-load-balancer-controller&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:39 [â¹]  created serviceaccount &quot;kube-system/ebs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:41 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-external-dns-external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:42 [â¹]  created namespace &quot;external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:42 [â¹]  created serviceaccount &quot;external-dns/external-dns&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:42 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-addon-iamserviceaccount-kube-system-efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [â¹]  created serviceaccount &quot;kube-system/efs-csi-controller-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [â¹]  daemonset &quot;kube-system/aws-node&quot; restarted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [â¹]  waiting for the control plane availability...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [â]  saved kubeconfig as &quot;/Users/ruzickap/git/k8s-eks-bottlerocket-fargate/kubeconfig-kube1.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [â¹]  no tasks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:43 [â]  all EKS cluster resources for &quot;kube1&quot; have been created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:44 [â¹]  kubectl command should work with &quot;/Users/ruzickap/git/k8s-eks-bottlerocket-fargate/kubeconfig-kube1.conf&quot;, try &#x27;kubectl --kubeconfig=/Users/ruzickap/git/k8s-eks-bottlerocket-fargate/kubeconfig-kube1.conf get nodes&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:44 [â]  EKS cluster &quot;kube1&quot; in &quot;eu-west-1&quot; region is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps &quot;aws-node&quot; deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/calico-config created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/kubecontrollersconfigurations.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/calico-node created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/calico-node created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps/calico-node created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/calico-node created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Warning: policy/v1beta1 PodDisruptionBudget is deprecated in v1.21+, unavailable in v1.25+; use policy/v1 PodDisruptionBudget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">poddisruptionbudget.policy/calico-kube-controllers created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:59 [â¹]  eksctl version 0.75.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:18:59 [â¹]  using region eu-west-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:15 [â¹]  nodegroup &quot;managed-ng-1&quot; will use &quot;&quot; [Bottlerocket/1.21]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:32 [â¹]  1 nodegroup (managed-ng-1) was included (based on the include/exclude rules)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:32 [â¹]  will create a CloudFormation stack for each of 1 managed nodegroups in cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:32 [â¹]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 sequential tasks: { fix cluster compatibility, 1 task: { 1 task: { create managed nodegroup &quot;managed-ng-1&quot; } }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:32 [â¹]  checking cluster stack for missing resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:41 [â¹]  cluster stack has all required resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:41 [â¹]  building managed nodegroup stack &quot;eksctl-kube1-nodegroup-managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:41 [â¹]  deploying stack &quot;eksctl-kube1-nodegroup-managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:19:41 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-nodegroup-managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:22:59 [â¹]  waiting for CloudFormation stack &quot;eksctl-kube1-nodegroup-managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  no tasks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â]  created 0 nodegroup(s) in cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  nodegroup &quot;managed-ng-1&quot; has 3 node(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  node &quot;ip-192-168-31-11.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  node &quot;ip-192-168-56-82.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  node &quot;ip-192-168-60-184.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  waiting for at least 2 node(s) to become ready in &quot;managed-ng-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  nodegroup &quot;managed-ng-1&quot; has 3 node(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  node &quot;ip-192-168-31-11.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  node &quot;ip-192-168-56-82.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â¹]  node &quot;ip-192-168-60-184.eu-west-1.compute.internal&quot; is ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:00 [â]  created 1 managed nodegroup(s) in cluster &quot;kube1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:12 [â¹]  checking security group configuration for all nodegroups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:12 [â¹]  all nodegroups have up-to-date cloudformation templates</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When the cluster is ready it immediately start pushing logs to CloudWatch under
<code>/aws/eks/kube1/cluster</code>.</p>
<p>Add add the user or role to the aws-auth ConfigMap. This is handy if you are
using different user for cli operations and different user/role for accessing
the AWS Console to see EKS Workloads in Cluster&#x27;s tab.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ! eksctl get iamidentitymapping --cluster=&quot;${CLUSTER_NAME}&quot; --region=&quot;${AWS_DEFAULT_REGION}&quot; --arn=${AWS_CONSOLE_ADMIN_ROLE_ARN}; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eksctl create iamidentitymapping --cluster=&quot;${CLUSTER_NAME}&quot; --region=&quot;${AWS_DEFAULT_REGION}&quot; --arn=&quot;${AWS_CONSOLE_ADMIN_ROLE_ARN}&quot; --group system:masters --username admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:13 [â¹]  eksctl version 0.75.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:13 [â¹]  using region eu-west-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-29 18:23:14 [â¹]  adding identity &quot;arn:aws:iam::7xxxxxxxxxx7:role/AxxxxxxxxxxxxN&quot; to auth ConfigMap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Check the nodes+pods and max number of nodes which can be scheduled on one node:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes,pods -o wide --all-namespaces</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                STATUS   ROLES    AGE   VERSION   INTERNAL-IP      EXTERNAL-IP     OS-IMAGE                               KERNEL-VERSION   CONTAINER-RUNTIME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node/ip-192-168-31-11.eu-west-1.compute.internal    Ready    &lt;none&gt;   81s   v1.21.6   192.168.31.11    54.194.69.158   Bottlerocket OS 1.4.1 (aws-k8s-1.21)   5.10.68          containerd://1.5.5+bottlerocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node/ip-192-168-56-82.eu-west-1.compute.internal    Ready    &lt;none&gt;   86s   v1.21.6   192.168.56.82    3.250.52.238    Bottlerocket OS 1.4.1 (aws-k8s-1.21)   5.10.68          containerd://1.5.5+bottlerocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node/ip-192-168-60-184.eu-west-1.compute.internal   Ready    &lt;none&gt;   84s   v1.21.6   192.168.60.184   54.75.89.58     Bottlerocket OS 1.4.1 (aws-k8s-1.21)   5.10.68          containerd://1.5.5+bottlerocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE     NAME                                           READY   STATUS    RESTARTS   AGE     IP               NODE                                           NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/calico-kube-controllers-6c85b56fcb-5g5cq   1/1     Running   0          4m16s   172.16.166.130   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/calico-node-4whs8                          1/1     Running   0          84s     192.168.60.184   ip-192-168-60-184.eu-west-1.compute.internal   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/calico-node-nbjsn                          1/1     Running   0          86s     192.168.56.82    ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/calico-node-nnhwz                          1/1     Running   0          81s     192.168.31.11    ip-192-168-31-11.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/coredns-7cc879f8db-ct5bp                   1/1     Running   0          21m     172.16.166.131   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/coredns-7cc879f8db-h4mbs                   1/1     Running   0          21m     172.16.166.129   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/kube-proxy-9c9wk                           1/1     Running   0          86s     192.168.56.82    ip-192-168-56-82.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/kube-proxy-gqbt7                           1/1     Running   0          81s     192.168.31.11    ip-192-168-31-11.eu-west-1.compute.internal    &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   pod/kube-proxy-q7pzh                           1/1     Running   0          84s     192.168.60.184   ip-192-168-60-184.eu-west-1.compute.internal   &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/eks">EKS</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docosaurus-test/blog/tags/pipeline-templates">Pipeline Templates</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/ruzickap/blog-test.ruzicka.dev/tree/main/docosaurus-test/blog/2020/2020-12-10-eks-test.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docosaurus-test/blog/mdx-blog-post"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">MDX Blog Post</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docosaurus-test/blog/image-test-eks-post"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Image Test EKS Post</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docosaurus-test/blog/test-eks-post#requirements">Requirements</a></li><li><a class="table-of-contents__link toc-highlight" href="/docosaurus-test/blog/test-eks-post#prepare-the-local-working-environment">Prepare the local working environment</a></li><li><a class="table-of-contents__link toc-highlight" href="/docosaurus-test/blog/test-eks-post#configure-aws-route-53-domain-delegation">Configure AWS Route 53 Domain delegation</a></li><li><a class="table-of-contents__link toc-highlight" href="/docosaurus-test/blog/test-eks-post#add-new-domain-to-route-53-policies-s3-ebs">Add new domain to Route 53, Policies, S3, EBS</a></li><li><a class="table-of-contents__link toc-highlight" href="/docosaurus-test/blog/test-eks-post#create-amazon-eks">Create Amazon EKS</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docosaurus-test/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docosaurus-test/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© Petr Ruzicka 2024 | Documentation Distributed under <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></div></footer></div>
</body>
</html>